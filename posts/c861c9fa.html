<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">










  <meta name="google-site-verification" content="l5vBARY4Edthuemwa9JDbqEGmhqH4SKJqmwMa1ysk2U">







  <meta name="baidu-site-verification" content="VL3JGnOsfz">



  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext">
  






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-blog.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-blog.png?v=7.1.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="本质上，webpack 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle。">
<meta name="keywords" content="webpack">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack4">
<meta property="og:url" content="https://www.vigor666.com/posts/c861c9fa.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="本质上，webpack 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.vigor666.com/images/webpack4.assets/Tapable.webp">
<meta property="og:updated_time" content="2021-06-15T16:11:55.954Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="webpack4">
<meta name="twitter:description" content="本质上，webpack 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle。">
<meta name="twitter:image" content="https://www.vigor666.com/images/webpack4.assets/Tapable.webp">





  
  
  <link rel="canonical" href="https://www.vigor666.com/posts/c861c9fa">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>webpack4 | Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-guestbook">

    
    
    
      
    

    

    <a href="/guestbook" rel="section"><i class="menu-item-icon fa fa-fw fa-comment"></i> <br>留言</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.vigor666.com/posts/c861c9fa.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="00前的小老弟">
      <meta itemprop="description" content="让兴趣变得更专业,让专业变得更兴趣">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">webpack4

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-01-12 10:05:23" itemprop="dateCreated datePublished" datetime="2020-01-12T10:05:23+08:00">2020-01-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-06-16 00:11:55" itemprop="dateModified" datetime="2021-06-16T00:11:55+08:00">2021-06-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/posts/c861c9fa.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/c861c9fa.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/posts/c861c9fa.html" class="leancloud_visitors" data-flag-title="webpack4">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">6.1k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">6 分钟</span>
              
            </div>
          

          
            <div class="post-description">本质上，webpack 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle。</div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="概念"><a class="markdownIt-Anchor" href="#概念"></a> 概念</h2>
<p><a href="https://www.webpackjs.com/concepts/" target="_blank" rel="noopener">https://www.webpackjs.com/concepts/</a></p>
<h2 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h2>
<p>生成 <code>package.json</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>
<p>安装<code>webpack</code> 和 <code>webpack-cli</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-D  开发依赖，上线不需要</span></span><br><span class="line">yarn add webpack webpack-cli -D</span><br></pre></td></tr></table></figure>
<p>打包文件命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br><span class="line"><span class="comment">#这个指令直接就默认生成dist的main.js，默认是生产环境</span></span><br><span class="line"><span class="comment">#支持模块化  可以用commonJS语法</span></span><br></pre></td></tr></table></figure>
<p>安装常用 <code>loader</code>  和<code>plugin</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># webpack-dev-server是webpack官方提供的一个小型Express服务器。使用它可以为webpack打包生成的资源文件提供web服务。</span></span><br><span class="line"><span class="comment"># webpack-dev-server 主要提供两个功能：</span></span><br><span class="line"><span class="comment"># - 为静态文件提供服务</span></span><br><span class="line"><span class="comment"># - 自动刷新和热替换(HMR)</span></span><br><span class="line">yarn add webpack-dev-server</span><br></pre></td></tr></table></figure>
<h2 id="基础配置-webpackconfigjs"><a class="markdownIt-Anchor" href="#基础配置-webpackconfigjs"></a> 基础配置 <code>webpack.config.js</code></h2>
<h3 id="html-插件"><a class="markdownIt-Anchor" href="#html-插件"></a> <code>html</code> 插件</h3>
<p>安装 <code>html-webpack-plugin</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 挂载到内存的插件</span></span><br><span class="line">yarn add html-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<p><code>webpack.config.js</code> 文件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// html挂载到内存的插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line"> template: <span class="string">'./src/index.html'</span> ,<span class="comment">//模板,导出的html文件将以此文件作为模板</span></span><br><span class="line"> filename: <span class="string">'index.html'</span>,</span><br><span class="line">    </span><br><span class="line"> <span class="comment">/* //压缩 html ，上线版本可以使用</span></span><br><span class="line"><span class="comment"> minify: &#123;</span></span><br><span class="line"><span class="comment"> //删除属性双引号</span></span><br><span class="line"><span class="comment"> removeAttributeQuotes:true,</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> //变成一行</span></span><br><span class="line"><span class="comment"> collapseWhitespace:true,</span></span><br><span class="line"><span class="comment"> &#125;,</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> //有一个hash值</span></span><br><span class="line"><span class="comment"> hash : true */</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  配置 html-webpack-plugin的第一种方法  一般不用  直接在package.json中配置就可以</span></span><br><span class="line"><span class="comment">devServer: &#123;</span></span><br><span class="line"><span class="comment">//开发服务器的配置</span></span><br><span class="line"><span class="comment">port: 3000,</span></span><br><span class="line"><span class="comment">progress: true,</span></span><br><span class="line"><span class="comment">contentBase: "./src",</span></span><br><span class="line"><span class="comment">//启动gzip压缩</span></span><br><span class="line"><span class="comment">compress: true</span></span><br><span class="line"><span class="comment">&#125;, */</span></span><br><span class="line"></span><br><span class="line">mode: <span class="string">"development"</span>, <span class="comment">//模式，有2种：production(默认)、development</span></span><br><span class="line">entry: <span class="string">"./src/index.js"</span>, <span class="comment">//入口</span></span><br><span class="line">output: &#123;</span><br><span class="line">	<span class="comment">// filename: "bundle.js.[hash:8]", //配置hash  :8只显示8位</span></span><br><span class="line">	filename: <span class="string">"bundle.js"</span>, <span class="comment">//打包后的文件名</span></span><br><span class="line">	path: path.resolve(__dirname, <span class="string">"dist"</span>) , <span class="comment">//路径必须是一个绝对路径,默认是在dist目录</span></span><br><span class="line">	<span class="comment">// publicPath:  'http://www.hanke.com' //公共的路径, 导出html文件里的所有src属性值都会带有该域名前缀 </span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">plugins: [   <span class="comment">//数组 放着所有webpack的插件</span></span><br><span class="line">	htmlPlugin</span><br><span class="line">],</span><br><span class="line">    </span><br><span class="line"><span class="built_in">module</span>: &#123;   <span class="comment">//模块</span></span><br><span class="line">    rules: [  </span><br><span class="line">        <span class="comment">//配置 html读取img的src</span></span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.html$/</span>,  <span class="comment">// .html的文件，匹配文件后缀</span></span><br><span class="line">            use: <span class="string">'xxx-loader'</span> <span class="comment">// 使用某个loader</span></span><br><span class="line">            <span class="comment">// loader的特点是功能单一</span></span><br><span class="line">            <span class="comment">// loader的用法  字符串只用一个loader  多个需要数组</span></span><br><span class="line">            <span class="comment">// loader 的顺序  默认从右到左执行 从下到上执行</span></span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>导出的 <code>./dist</code> 里面的 <code>bundle.js</code> 的文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap   webpack入口函数</span></span><br><span class="line">	<span class="comment">// The module cache   定义一个缓存</span></span><br><span class="line">	<span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line">	<span class="comment">// The require function    配置实现了 require方法</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// Check if module is in cache   检查是否在缓存中</span></span><br><span class="line">		<span class="keyword">if</span>(installedModules[moduleId]) &#123;</span><br><span class="line">			<span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line">		<span class="keyword">var</span> <span class="built_in">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line">			i: moduleId,</span><br><span class="line">			l: <span class="literal">false</span>,</span><br><span class="line">			exports: &#123;&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="comment">// Execute the module function    call方法</span></span><br><span class="line">		modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line">		<span class="comment">// Flag the module as loaded</span></span><br><span class="line">		<span class="built_in">module</span>.l = <span class="literal">true</span>;</span><br><span class="line">		<span class="comment">// Return the exports of the module   返回module.exports</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="string">"./src/index.js"</span>);<span class="comment">//入口模块</span></span><br><span class="line">&#125;)</span><br><span class="line">(&#123;</span><br><span class="line"><span class="string">"./src/a.js"</span>:   <span class="comment">//key-&gt;模块的路径</span></span><br><span class="line"><span class="comment">/*! no static exports found */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;  <span class="comment">//value函数</span></span><br><span class="line">	<span class="built_in">eval</span>(<span class="string">"console.log('我能行')\n\n//# sourceURL=webpack:///./src/a.js?"</span>);</span><br><span class="line">&#125;),</span><br><span class="line"><span class="string">"./src/index.js"</span>:</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"><span class="comment">//递归 先执行./src/a.js  再执行index.js下边的方法</span></span><br><span class="line">	<span class="built_in">eval</span>(<span class="string">"__webpack_require__(/*! ./a.js */ \"./src/a.js\")\r\n\r\nconsole.log('ok')\n\n//# sourceURL=webpack:///./src/index.js?"</span>);</span><br><span class="line">&#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="样式处理"><a class="markdownIt-Anchor" href="#样式处理"></a> 样式处理</h3>
<p>需要安装的模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 css-loader style-loader 解析css文件</span></span><br><span class="line">yarn add css-loader style-loader -D</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 less less-loader 解析less文件（前边的css以及style都用的到 还有一个顺序问题）</span></span><br><span class="line">yarn add less less-loader -D </span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 node-sass sass-loader 解析sass文件</span></span><br><span class="line">yarn add node-sass sass-loader -D </span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 mini-css-extract-plugin 抽离css  将css变成link的形式引入</span></span><br><span class="line">yarn add mini-css-extract-plugin -D</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 postcss-loader autoprefixer自动为css添加私有化前缀 </span></span><br><span class="line">yarn add postcss-loader autoprefixer -D</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 optimize-css-assets-webpack-plugin 来自动压缩css文件</span></span><br><span class="line">yarn add optimize-css-assets-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<p><code>webpack.config.js</code> 文件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// html挂载到内存的插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将css变成link引入的插件</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩css的插件</span></span><br><span class="line"><span class="keyword">const</span> OptimizeCSSAssetsPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">  filename: <span class="string">'index.html'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mode: <span class="string">"development"</span>,</span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">  	<span class="comment">// filename: "bundle.js.[hash:8]",</span></span><br><span class="line">  	filename: <span class="string">"bundle.js"</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  htmlPlugin,</span><br><span class="line">  <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    filename: <span class="string">'./css/main.css'</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>: &#123;   <span class="comment">//模块</span></span><br><span class="line">  <span class="comment">//规则    css-loader 处理css文件 解析@import这种语法</span></span><br><span class="line">	<span class="comment">// style-loader  把css标签插入到header中</span></span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'style-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            <span class="comment">//将style标签插入到顶部</span></span><br><span class="line">            insertAt: <span class="string">'top'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'css-loader'</span>,</span><br><span class="line">        <span class="comment">//为loader添加私有化前缀</span></span><br><span class="line">        <span class="string">'postcss-loader'</span>,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/* //配置less</span></span><br><span class="line"><span class="comment">		&#123;</span></span><br><span class="line"><span class="comment">			test:/\.less$/,</span></span><br><span class="line"><span class="comment">			use:[</span></span><br><span class="line"><span class="comment"> 			  &#123;</span></span><br><span class="line"><span class="comment">    			loader:'style-loader',</span></span><br><span class="line"><span class="comment">    			options: &#123;</span></span><br><span class="line"><span class="comment">     			 //将style标签插入到顶部</span></span><br><span class="line"><span class="comment">      			insertAt: 'top'</span></span><br><span class="line"><span class="comment">    			&#125;</span></span><br><span class="line"><span class="comment">  		  &#125;,</span></span><br><span class="line"><span class="comment">  			'css-loader',</span></span><br><span class="line"><span class="comment">  			'less-loader' //less -&gt; css</span></span><br><span class="line"><span class="comment">			]</span></span><br><span class="line"><span class="comment">		&#125; */</span></span><br><span class="line"><span class="comment">//抽离为</span></span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        MiniCssExtractPlugin.loader,</span><br><span class="line">        <span class="string">'css-loader'</span>,</span><br><span class="line">        <span class="string">'postcss-loader'</span>,</span><br><span class="line">        <span class="string">'less-loader'</span> <span class="comment">//less -&gt; css</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>在 <code>./src</code> 目录中，</strong></p>
<p><code>index.css</code> 文件：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">'./a.css'</span>;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: antiquewhite;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(45deg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>a.css</code>  文件：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  div &#123;</span><br><span class="line">    <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-tag">gray</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>index.less</code> 文件：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid gray;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>./build</code> 目录下，有 <code>bundle.js</code> 、 <code>index.html</code>  以及 <code>./build/css</code> 的 <code>main.css</code></p>
<h3 id="转换-es6-语法"><a class="markdownIt-Anchor" href="#转换-es6-语法"></a> 转换 <code>ES6</code> 语法</h3>
<p>需要安装的模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 babel-loader @babel/core @babel/preset-env 来转换es6 语法</span></span><br><span class="line">yarn add babel-loader @babel/core @babel/preset-env -D</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 @babel/plugin-proposal-class-properties 来解析类语法</span></span><br><span class="line">yarn add @babel/plugin-proposal-class-properties -D</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 @babel/plugin-proposal-decorators 来解析 @log(decorators-legacy)这种语法 （这个没见过)</span></span><br><span class="line"><span class="comment">#这里的配置出现了不少错误  还是不怎么熟练 </span></span><br><span class="line">yarn add @babel/plugin-proposal-decorators -D</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 @babel/plugin-transform-runtime 来处理js语法</span></span><br><span class="line">yarn add @babel/plugin-transform-runtime -D</span><br><span class="line">yarn add @babel/runtime  <span class="comment">#什么都不加 这个上线也用得到</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 @babel/polyfill 来解决高级用法的问题(如 字符串的includes用法)</span></span><br><span class="line">yarn add @babel/polyfill  <span class="comment">#没有 -D</span></span><br></pre></td></tr></table></figure>
<p><code>webpack.config.js</code> 文件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// html挂载到内存的插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">  filename: <span class="string">'index.html'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mode: <span class="string">"development"</span>,</span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">  	<span class="comment">// filename: "bundle.js",</span></span><br><span class="line">  	filename: <span class="string">"bundle.js"</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  htmlPlugin,</span><br><span class="line">  <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    filename: <span class="string">'./css/main.css'</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    <span class="comment">/* 配置babel */</span></span><br><span class="line">		&#123;</span><br><span class="line">  		test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    	use: [</span><br><span class="line">      	&#123;</span><br><span class="line">        	loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">        	options: &#123;</span><br><span class="line">          	presets: [<span class="string">'@babel/preset-env'</span>],</span><br><span class="line">          	plugins: [</span><br><span class="line">            	<span class="comment">// '@babel/plugin-proposal-class-properties'  解析class</span></span><br><span class="line">            	<span class="comment">// 上边边解析  @log</span></span><br><span class="line">            	[<span class="string">"@babel/plugin-proposal-decorators"</span>, &#123; <span class="string">"legacy"</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">            	[<span class="string">'@babel/plugin-proposal-class-properties'</span>, &#123; <span class="string">"loose"</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">            	<span class="string">'@babel/plugin-transform-runtime'</span></span><br><span class="line"></span><br><span class="line">         	  ]</span><br><span class="line">        	&#125;</span><br><span class="line">      	&#125;</span><br><span class="line">    	],</span><br><span class="line">      <span class="comment">//包括</span></span><br><span class="line">      include: path.resolve(__dirname, <span class="string">'src'</span>),</span><br><span class="line">      <span class="comment">//排除</span></span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">		&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在 <code>./src</code> 目录中的 <code>index.js</code> 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此处都是 es6 语法，由于有些浏览器不支持es6标准，所以要用babel转成es5的代码</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'@babel/polyfill'</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"./a.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2222</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">gen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(gen().next())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'aaa'</span>.includes(<span class="string">'a'</span>))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  c = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@log</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">	a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> A()</span><br><span class="line"><span class="built_in">console</span>.log(a.a)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(target)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="js-语法校验"><a class="markdownIt-Anchor" href="#js-语法校验"></a> <code>js</code> 语法校验</h3>
<p>需要安装的模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 eslint eslint-loader 来校验js语法</span></span><br><span class="line">yarn add eslint eslint-loader -D</span><br></pre></td></tr></table></figure>
<p><code>webpack.config.js</code> 文件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// html挂载到内存的插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">  filename: <span class="string">'index.html'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mode: <span class="string">"development"</span>,</span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">  	<span class="comment">// filename: "bundle.js",</span></span><br><span class="line">  	filename: <span class="string">"bundle.js"</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">plugins: [htmlPlugin],</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">   &#123;</span><br><span class="line">			test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      use:[</span><br><span class="line">  			&#123;</span><br><span class="line">    			loader: <span class="string">'eslint-loader'</span>,</span><br><span class="line">    			options: &#123;</span><br><span class="line">      			<span class="comment">//强制 pre 之前执行  post 之后  未设置为normal 普通的loader</span></span><br><span class="line">      			enforce: <span class="string">'pre'</span></span><br><span class="line">    			&#125;</span><br><span class="line">  			&#125;</span><br><span class="line">			],</span><br><span class="line">      <span class="comment">//排除</span></span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">		&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>.eslintrc.json</code>  文件：</p>
<blockquote>
<p>直接在<code>eslint</code>官网生成 : <a href="https://cn.eslint.org/demo/" target="_blank" rel="noopener">https://cn.eslint.org/demo/</a></p>
</blockquote>
<h3 id="全局变量的引入"><a class="markdownIt-Anchor" href="#全局变量的引入"></a> 全局变量的引入</h3>
<h3 id><a class="markdownIt-Anchor" href="#"></a> </h3>
<p>需要安装的模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 jquery 来 测试暴露全局的loader</span></span><br><span class="line">yarn add jquery -D</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 expose-loader 来暴露全局</span></span><br><span class="line">yarn add expose-loader -D</span><br></pre></td></tr></table></figure>
<p><code>webpack.config.js</code> 文件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// html挂载到内存的插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">  filename: <span class="string">'index.html'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mode: <span class="string">"development"</span>,</span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">  	<span class="comment">// filename: "bundle.js",</span></span><br><span class="line">  	filename: <span class="string">"bundle.js"</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">plugins: [htmlPlugin],</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">			<span class="comment">// 添加loader规则 就不再需要import $ from 'expose-loader?$!jquery' 这样，可以直接 import </span></span><br><span class="line">    	test: <span class="built_in">require</span>.resolve(<span class="string">'jquery'</span>),</span><br><span class="line">    	use: <span class="string">'expose-loader?$'</span>,</span><br><span class="line">   &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在 <code>./src</code> 中的 <code>index.js</code>  文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import $ from 'expose-loader?$!jquery'; // 内联loader</span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</span><br><span class="line"><span class="built_in">console</span>.log($);</span><br><span class="line"><span class="comment">// expose-loader 暴露全局的loader</span></span><br><span class="line"><span class="comment">// pre： 前面执行的loader， normal：普通loader，内联loader，后置postloader </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.$);</span><br></pre></td></tr></table></figure>
<h3 id="图片处理"><a class="markdownIt-Anchor" href="#图片处理"></a> 图片处理</h3>
<p>需要安装的模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 file-loader 默认生成一张新的图片到build目录下 生成图片名字返回</span></span><br><span class="line">yarn add file-loader -D</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 html-with-loader 来解决 img src='' 这样的问题</span></span><br><span class="line">yarn add html-withimg-loader -D</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 url-loader 来处理图片 (一般不用file-loader来处理图片 )</span></span><br><span class="line">yarn add url-loader -D</span><br></pre></td></tr></table></figure>
<p><code>webpack.config.js</code> 文件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// html挂载到内存的插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">  filename: <span class="string">'index.html'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mode: <span class="string">"development"</span>,</span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">  	<span class="comment">// filename: "bundle.js",</span></span><br><span class="line">  	filename: <span class="string">"bundle.js"</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"build"</span>),</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">plugins: [htmlPlugin],</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    <span class="comment">//配置 html读取img的src</span></span><br><span class="line">		&#123;</span><br><span class="line">			test: <span class="regexp">/\.html$/</span>,</span><br><span class="line"> 			use: <span class="string">'html-withimg-loader'</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="comment">//配置 file-loader来读取图片</span></span><br><span class="line">		&#123;</span><br><span class="line">			test: <span class="regexp">/\.(png|jpg|gif)$/</span>, </span><br><span class="line">  		<span class="comment">//做一个限制  当小于多少k 用base64来转化 base64文件可以减少http请求 但是比原文件大3分之1</span></span><br><span class="line">			<span class="comment">// 否则用file-loader来产生真实的图片</span></span><br><span class="line"> 			use: &#123;</span><br><span class="line">  			loader: <span class="string">'url-loader'</span>,</span><br><span class="line">  			options: &#123;</span><br><span class="line">    		limit: <span class="number">1</span>,</span><br><span class="line">    		<span class="comment">//输出的路径</span></span><br><span class="line">    		outputPath: <span class="string">'img/'</span>,</span><br><span class="line">    		<span class="comment">//只在图片中有一个公共的路径，在解析img的loader中单独配置</span></span><br><span class="line">    		publicPath: <span class="string">'http:/111'</span></span><br><span class="line">  			&#125;</span><br><span class="line"> 			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>在 <code>./src</code> 中</strong></p>
<p><code>index.js</code>  文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//file-loader 图片引入 返回一个新图片地址</span></span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.jpg'</span></span><br><span class="line"><span class="built_in">console</span>.log(logo)</span><br><span class="line"><span class="keyword">let</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src = logo</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(img)</span><br></pre></td></tr></table></figure>
<p><code>index.css</code>  文件：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'./logo.jpg'</span>);</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">73px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">103px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h3>
<p>配置 <code>package.json</code></p>
<blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; //重要内容 注意  这样是不对的   json标准中不允许有解析</span><br><span class="line">&gt; "scripts": &#123;</span><br><span class="line">&gt;  "build": "webpack",</span><br><span class="line">&gt;  "dev": "webpack-dev-server --open --port 3000 --hot "</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>为什么是webpack.config.js</strong></p>
<blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment">//node_modules 下的webpack-cli 下的bin下的config中的config-yargs.js的这一句话</span></span><br><span class="line">&gt; 	defaultDescription: <span class="string">"webpack.config.js or webpackfile.js"</span>,</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>webpack.config.js改名之后运行</strong></p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> npx webpack --config webpack.config.my.js  </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>或者  <strong>package.json中配置</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; "scripts": &#123;</span><br><span class="line">&gt; "build" : "webpack --config webpack.config.my.js"</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; //执行  npm run build  </span><br><span class="line">&gt; "scripts": &#123;</span><br><span class="line">&gt; "build" : "webpack "</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; //执行 npm run build -- --config webpack.config.my.js</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>postcss.config.js配置（添加私有化前缀时需要配置）</strong></p>
<blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">&gt; plugins: [<span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)]</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h2>
<h3 id="常用的小插件"><a class="markdownIt-Anchor" href="#常用的小插件"></a> 常用的小插件</h3>
<p><strong>安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装clean-webpack-plugin 每次打包先清除dist目录下的文件</span></span><br><span class="line">yarn add clean-webpack-plugin -D</span><br><span class="line"><span class="comment"># 安装copy-webpack-plugin  打包时可以把一些文件夹的内容拷贝到其他文件夹</span></span><br><span class="line">yarn add copy-webpack-plugin -D</span><br><span class="line"><span class="comment"># webpack 自带的插件 可以加入注释声明谁开发的  webpack.BannerPlugin()</span></span><br><span class="line"><span class="comment"># 安装webpack-dev-middleware webpack开发服务的一个中间件</span></span><br><span class="line">yarn add webpack-dev-middleware -D</span><br><span class="line"><span class="comment"># webpack 自带的插件 判断开发环境   webpack.DefinePlugin()</span></span><br><span class="line"><span class="comment"># 安装webpack-merge 来区分不同的环境 有webpack.base.js webpack.dev.js webpack.pro.js</span></span><br><span class="line">yarn add webpack-merge -D</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> CopyPlugin([</span><br><span class="line">      &#123;<span class="attr">from</span>: <span class="string">'doc'</span>, <span class="attr">to</span>: <span class="string">'./'</span>&#125;</span><br><span class="line">    ]),</span><br><span class="line">    <span class="keyword">new</span> webpack.BannerPlugin(<span class="string">'make by zww'</span>),</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>
<h3 id="打包多页应用"><a class="markdownIt-Anchor" href="#打包多页应用"></a> 打包多页应用</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多入口需要写成一个对象</span></span><br><span class="line"><span class="comment">//两个入口</span></span><br><span class="line">mode: <span class="string">'development'</span>,</span><br><span class="line">entry: &#123;</span><br><span class="line">  <span class="comment">//首页</span></span><br><span class="line">  home: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  <span class="comment">//other页相关</span></span><br><span class="line">  other: <span class="string">'./src/other.js'</span> </span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//两个出口</span></span><br><span class="line">output:&#123;</span><br><span class="line">  <span class="comment">// name代表 home或者other  .[hash] 给文件加一个hash串</span></span><br><span class="line">  <span class="comment">// filename: '[name].[hash].js',</span></span><br><span class="line">  filename: <span class="string">'[name].js'</span>,</span><br><span class="line">  path: path.resolve(__dirname,<span class="string">'dist'</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="dev-tool的四个选项"><a class="markdownIt-Anchor" href="#dev-tool的四个选项"></a> dev-tool的四个选项</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  增加 devtool 源码映射 可以很方便的调试源代码  </span></span><br><span class="line"><span class="comment">//  源码映射 单独生成一个 source-map文件 出错会标识出错的列和行 大和全</span></span><br><span class="line">devtool:<span class="string">'source-map'</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">//  不会单独生成一个文件 但会显示行和列</span></span><br><span class="line">devtool: <span class="string">'eval-source-map'</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">//  不会产生单独列 但会生成一个映射文件</span></span><br><span class="line">devtool: <span class="string">'cheap-module-source-map'</span>, <span class="comment">//保留 后来调试用</span></span><br><span class="line"><span class="comment">//  不会单独生成文件 集成在打包文件中 也不产生列</span></span><br><span class="line">devtool: <span class="string">'cheap-module-eval-source-map'</span>,</span><br></pre></td></tr></table></figure>
<h3 id="webpack跨域问题"><a class="markdownIt-Anchor" href="#webpack跨域问题"></a> webpack跨域问题</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  server.js </span></span><br><span class="line"><span class="comment">//  1</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express()</span><br><span class="line">app.get(<span class="string">'/api/user'</span>,(req,res)=&gt;&#123;</span><br><span class="line">res.json(&#123;</span><br><span class="line">	name: <span class="string">'myname222'</span></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3500</span>)</span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express()</span><br><span class="line">app.get(<span class="string">'/user'</span>,(req,res)=&gt;&#123;</span><br><span class="line">res.json(&#123;</span><br><span class="line">	name: <span class="string">'myname222'</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3500</span>)</span><br></pre></td></tr></table></figure>
<p><strong>对应解决方法</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line"><span class="comment">//这是 服务器为 /api/user  1解决方法</span></span><br><span class="line">proxy : &#123;</span><br><span class="line"><span class="string">'/api'</span>:<span class="string">'http://localhost:3500'</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// /user的用法   2解决方法</span></span><br><span class="line">proxy: &#123;</span><br><span class="line"><span class="string">'/api'</span>: &#123;</span><br><span class="line">  target: <span class="string">'http://localhost:3500'</span>,</span><br><span class="line">  pathRewrite: &#123;</span><br><span class="line">    <span class="string">'/api'</span>:<span class="string">'/'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//前端只想单纯模拟方法</span></span><br><span class="line">before(app)&#123; <span class="comment">//提供的方法 相当于钩子 </span></span><br><span class="line"><span class="comment">//写这些代码就不存在跨域问题 </span></span><br><span class="line">app.get(<span class="string">'/user'</span>,(req,res)=&gt;&#123;</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    name: <span class="string">'myname-before'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//有服务端，但是不用代理来处理 在服务器端开启webpack 端口用服务端端口</span></span><br><span class="line"> <span class="comment">//server.js   后端加前端合在一起解决跨域</span></span><br><span class="line"> <span class="comment">//webpack自带一个express</span></span><br><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express()</span><br><span class="line"><span class="keyword">let</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="comment">//需要使用中间件  需要安装</span></span><br><span class="line"><span class="keyword">let</span> middle = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</span><br><span class="line"><span class="keyword">let</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.config.js'</span>)</span><br><span class="line"><span class="keyword">let</span> compiler = webpack(config)</span><br><span class="line">app.use(middle(compiler))</span><br><span class="line">app.get(<span class="string">'/api/user'</span>,(req,res)=&gt;&#123;</span><br><span class="line">   res.json(&#123;</span><br><span class="line">     name: <span class="string">'myname222'</span></span><br><span class="line">   &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3500</span>)</span><br></pre></td></tr></table></figure>
<h3 id="watch监视"><a class="markdownIt-Anchor" href="#watch监视"></a> watch监视</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//监控 实时打包   类似node里边那个实时监控的</span></span><br><span class="line">watch: <span class="literal">true</span>,</span><br><span class="line"><span class="comment">//监控的选项</span></span><br><span class="line">watchOptions: &#123;</span><br><span class="line"> poll: <span class="number">1000</span>, <span class="comment">//每秒问1000次</span></span><br><span class="line"> aggregateTimeout: <span class="number">500</span> ,<span class="comment">//防抖 （类似于函数防抖）</span></span><br><span class="line"> ignored: <span class="regexp">/node_modules/</span> <span class="comment">//忽略哪个文件</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="resolve属性"><a class="markdownIt-Anchor" href="#resolve属性"></a> resolve属性</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line"> <span class="comment">//指定解析的模块</span></span><br><span class="line"> 	modules: [path.resolve(<span class="string">'node_modules'</span>)],</span><br><span class="line"> <span class="comment">// mainFiles: [],//入口文件的名字 默认找index.js</span></span><br><span class="line"> <span class="comment">//或者用 mainFields  入口的字段 先找style 再找main</span></span><br><span class="line"> 	mainFields: [<span class="string">'style'</span>,<span class="string">'main'</span>],</span><br><span class="line"> <span class="comment">//扩展名 可以省略 需配置 extensions  依次解析</span></span><br><span class="line"> 	extensions: [<span class="string">'.js'</span>,<span class="string">'.css'</span>,<span class="string">'.json'</span>]</span><br><span class="line"> <span class="comment">//别名  如 vue的vue-runtime和那个@</span></span><br><span class="line"> <span class="comment">// alias: &#123;</span></span><br><span class="line"> <span class="comment">//   bootstrap: 'bootstrap/dist/css/bootstrap.css'</span></span><br><span class="line"> <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="生产或者开发环境配置"><a class="markdownIt-Anchor" href="#生产或者开发环境配置"></a> 生产或者开发环境配置</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.pro.js</span></span><br><span class="line"><span class="keyword">let</span> &#123;smart&#125; = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">let</span> base = <span class="built_in">require</span>(<span class="string">'./webpack.config.js'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = smart(base,&#123;</span><br><span class="line">	mode:<span class="string">'production'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//webpack.dev.js</span></span><br><span class="line"><span class="keyword">let</span> &#123;smart&#125; = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">let</span> base = <span class="built_in">require</span>(<span class="string">'./webpack.config.js'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = smart(base,&#123;</span><br><span class="line">	mode:<span class="string">'development'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="webpackconfigjs"><a class="markdownIt-Anchor" href="#webpackconfigjs"></a> webpack.config.js</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="comment">//内置插件  版权归谁谁谁所有 先导入webpack</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//copy插件</span></span><br><span class="line"><span class="keyword">const</span> copyWpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// bannerPlugin 版权声明</span></span><br><span class="line"><span class="keyword">const</span> bannerPlugin = <span class="keyword">new</span> webpack.BannerPlugin(<span class="string">'make by hanke ,i will become success!'</span>)</span><br><span class="line"><span class="comment">// 这个是错误写法  正确写法 应该是解构赋值那样写 说明这个插件包含许多东西</span></span><br><span class="line"><span class="comment">// const CleanWebpackPlugin = require('clean-webpack-plugin')</span></span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//拷贝文件</span></span><br><span class="line"><span class="keyword">const</span> copyPlugin = <span class="keyword">new</span> copyWpackPlugin(</span><br><span class="line"><span class="comment">//接受一个数组 可以多个文件</span></span><br><span class="line">[&#123;<span class="attr">from</span>:<span class="string">'./doc'</span>,<span class="attr">to</span>:<span class="string">'./'</span>&#125;]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 三个其他的小插件</span></span><br><span class="line"><span class="comment">// 1. cleanWebpackPlugin  // 每次打包会把dist目录下的文件都删除 重新打包</span></span><br><span class="line"><span class="comment">// 2. copyWebpackPlugin</span></span><br><span class="line"><span class="comment">// 3. bannerPlugin</span></span><br><span class="line"><span class="comment">// 前两个 需要第三方模块 第三个内置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断开发环境的插件  DefinePlugin</span></span><br><span class="line"><span class="keyword">const</span> definePlugin = <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">	DEV: <span class="built_in">JSON</span>.stringify(<span class="string">'production'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 也可以传入一个数组 告诉清理哪些文件夹</span></span><br><span class="line"><span class="keyword">const</span> cleanPlugin = <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin1 = <span class="keyword">new</span> HtmlWpackPlugin(&#123;</span><br><span class="line">template: <span class="string">'./src/index.html'</span>,</span><br><span class="line"><span class="comment">//多个 html	</span></span><br><span class="line">filename: <span class="string">'home.html'</span>,</span><br><span class="line"><span class="comment">//代码块</span></span><br><span class="line">chunks: [<span class="string">'home'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> htmlPlugin2 = <span class="keyword">new</span> HtmlWpackPlugin(&#123;</span><br><span class="line">template: <span class="string">'./src/index.html'</span>,</span><br><span class="line"><span class="comment">//多个 html</span></span><br><span class="line">filename: <span class="string">'other.html'</span>,</span><br><span class="line"><span class="comment">//代码块  放置引入的东西</span></span><br><span class="line">chunks: [<span class="string">'other'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlWpackPlugin(&#123;</span><br><span class="line">template: <span class="string">'./src/index.html'</span>,</span><br><span class="line"><span class="comment">//多个 html</span></span><br><span class="line">filename: <span class="string">'index.html'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"><span class="comment">//多入口需要写成一个对象</span></span><br><span class="line"><span class="comment">//两个入口</span></span><br><span class="line">mode: <span class="string">'development'</span>,</span><br><span class="line">entry: &#123;</span><br><span class="line"> <span class="comment">/* //首页</span></span><br><span class="line"><span class="comment"> home: './src/index.js',</span></span><br><span class="line"><span class="comment"> //other页相关</span></span><br><span class="line"><span class="comment"> other: './src/other.js' */</span></span><br><span class="line"></span><br><span class="line"> index: <span class="string">'./src/index.js'</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//两个出口</span></span><br><span class="line">output:&#123;</span><br><span class="line"> <span class="comment">// name代表 home或者other  .[hash] 给文件加一个hash串</span></span><br><span class="line"> <span class="comment">// filename: '[name].[hash].js',</span></span><br><span class="line"> filename: <span class="string">'[name].js'</span>,</span><br><span class="line"> path: path.resolve(__dirname,<span class="string">'dist'</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">/* //监控 实时打包   类似node里边那个实时监控的</span></span><br><span class="line"><span class="comment">watch: true,</span></span><br><span class="line"><span class="comment">//监控的选项</span></span><br><span class="line"><span class="comment">watchOptions: &#123;</span></span><br><span class="line"><span class="comment"> poll: 1000, //每秒问1000次</span></span><br><span class="line"><span class="comment"> aggregateTimeout: 500 ,//防抖 （类似于函数防抖）</span></span><br><span class="line"><span class="comment"> ignored: /node_modules/ //忽略哪个文件</span></span><br><span class="line"><span class="comment">&#125;, */</span></span><br><span class="line"><span class="comment">//增加 devtool 源码映射 可以很方便的调试源代码  </span></span><br><span class="line"><span class="comment">//  源码映射 单独生成一个 source-map文件 出错会标识出错的列和行 大和全</span></span><br><span class="line"><span class="comment">// devtool:'source-map',</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  不会单独生成一个文件 但会显示行和列</span></span><br><span class="line"><span class="comment">// devtool: 'eval-source-map',</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  不会产生单独列 但会生成一个映射文件</span></span><br><span class="line"><span class="comment">//devtool: 'cheap-module-source-map', //保留 后来调试用</span></span><br><span class="line"><span class="comment">//  不会单独生成文件 集成在打包文件中 也不产生列</span></span><br><span class="line">devtool: <span class="string">'cheap-module-eval-source-map'</span>,</span><br><span class="line">plugins: [</span><br><span class="line"> <span class="comment">// 打包多页面 </span></span><br><span class="line"> <span class="comment">// htmlPlugin1,</span></span><br><span class="line"> <span class="comment">// htmlPlugin2</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//学习 source-map使用</span></span><br><span class="line"> htmlPlugin,</span><br><span class="line"> <span class="comment">// 清除插件</span></span><br><span class="line"> cleanPlugin,</span><br><span class="line"> <span class="comment">// 复制插件</span></span><br><span class="line"> copyPlugin,</span><br><span class="line"> <span class="comment">// 内置插件 添加注释</span></span><br><span class="line"> bannerPlugin,</span><br><span class="line"> <span class="comment">// 内置插件 判断开发环境</span></span><br><span class="line"> definePlugin</span><br><span class="line">],</span><br><span class="line"><span class="comment">//解析第三方模块 commen</span></span><br><span class="line">resolve: &#123;</span><br><span class="line"> <span class="comment">//指定解析的模块</span></span><br><span class="line"> modules: [path.resolve(<span class="string">'node_modules'</span>)],</span><br><span class="line"> <span class="comment">//或者用 mainFields  入口的字段 先找style 再找main</span></span><br><span class="line"> <span class="comment">// mainFiles: [],//入口文件的名字 默认找index.js</span></span><br><span class="line"> mainFields: [<span class="string">'style'</span>,<span class="string">'main'</span>],</span><br><span class="line"> <span class="comment">//扩展名 可以省略 需配置 extensions  依次解析</span></span><br><span class="line"> extensions: [<span class="string">'.js'</span>,<span class="string">'.css'</span>,<span class="string">'.json'</span>]</span><br><span class="line"> <span class="comment">//别名  如 vue的vue-runtime和那个@</span></span><br><span class="line"> <span class="comment">// alias: &#123;</span></span><br><span class="line"> <span class="comment">//   bootstrap: 'bootstrap/dist/css/bootstrap.css'</span></span><br><span class="line"> <span class="comment">// &#125;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line"> rules: [</span><br><span class="line">   &#123;</span><br><span class="line">     test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">     use:[<span class="string">'style-loader'</span>,<span class="string">'css-loader'</span>]</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">     use: &#123;</span><br><span class="line">       loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">       options: &#123;</span><br><span class="line">         presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">       &#125;     </span><br><span class="line">     &#125;,</span><br><span class="line">     exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">   &#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//跨域问题的设置</span></span><br><span class="line">devServer:&#123;</span><br><span class="line"> <span class="comment">//这是 服务器为 /api/user</span></span><br><span class="line"> <span class="comment">/* proxy : &#123;</span></span><br><span class="line"><span class="comment">   '/api':'http://localhost:3500'</span></span><br><span class="line"><span class="comment"> &#125; */</span></span><br><span class="line"> <span class="comment">// /user的用法</span></span><br><span class="line"> <span class="comment">/* proxy: &#123;</span></span><br><span class="line"><span class="comment">   // 重写的方式 把请求代理到express服务器上</span></span><br><span class="line"><span class="comment">   '/api': &#123;</span></span><br><span class="line"><span class="comment">     target: 'http://localhost:3500',</span></span><br><span class="line"><span class="comment">     pathRewrite: &#123;</span></span><br><span class="line"><span class="comment">       '/api':'/'</span></span><br><span class="line"><span class="comment">     &#125;</span></span><br><span class="line"><span class="comment">   &#125;  </span></span><br><span class="line"><span class="comment"> &#125; */</span></span><br><span class="line"> <span class="comment">//前端只想单纯模拟方法</span></span><br><span class="line"> <span class="comment">/* before(app)&#123; //提供的方法 相当于钩子 </span></span><br><span class="line"><span class="comment">   //写这些代码就不存在跨域问题 </span></span><br><span class="line"><span class="comment">   app.get('/user',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="comment">     res.json(&#123;</span></span><br><span class="line"><span class="comment">       name: 'myname-before'</span></span><br><span class="line"><span class="comment">     &#125;)</span></span><br><span class="line"><span class="comment">   &#125;)</span></span><br><span class="line"><span class="comment"> &#125; */</span></span><br><span class="line"> <span class="comment">//有服务端，但是不用代理来处理 在服务器端开启webpack 端口用服务端端口</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="优化配置"><a class="markdownIt-Anchor" href="#优化配置"></a> 优化配置</h2>
<h3 id="安装-2"><a class="markdownIt-Anchor" href="#安装-2"></a> 安装</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#实现安装</span></span><br><span class="line">cnpm i webpack webpack-cli html-webpack-plugin @babel/core babel-loader @babel/preset-env @babel/preset-react webpack-dev-server -D</span><br><span class="line"><span class="comment">#安装jquery进行优化测试</span></span><br><span class="line">cnpm i jquery</span><br><span class="line"><span class="comment">#安装moment 时间插件</span></span><br><span class="line">cnpm i moment</span><br><span class="line"><span class="comment">#webpack内置插件 IgnorePlugin 优化</span></span><br><span class="line"><span class="comment">#安装 react react-dom 来测试动态链接库</span></span><br><span class="line">cnpm i react react-dom</span><br><span class="line"><span class="comment">#webpack内置插件 DllPlugin 产生一个manifest.json</span></span><br><span class="line"><span class="comment">#webpack内置插件 DllReferencePlugin 得到一个manifest.json</span></span><br><span class="line"><span class="comment">#安装 happypack来多线程打包webpack  适合项目比较大的时候使用</span></span><br><span class="line">cnpm i happypack -D</span><br><span class="line"><span class="comment">#安装 @babel/plugin-syntax-dynamic-import -D 来转换es6草案语法</span></span><br><span class="line">cnpm i @babel/plugin-syntax-dynamic-import -D</span><br><span class="line"><span class="comment">#webpack 自带插件 HotModuleReplacementPlugin和 NamedModulesPlugin实现热更新</span></span><br></pre></td></tr></table></figure>
<h3 id="webpack优化项"><a class="markdownIt-Anchor" href="#webpack优化项"></a> webpack优化项</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 不去解析jquery中的依赖库 </span></span><br><span class="line">noParse: <span class="regexp">/jquery/</span>,</span><br><span class="line"><span class="comment">//2. webpack自带的IgnorePlugin 忽略掉moment中locale引入的东西</span></span><br><span class="line">	<span class="keyword">const</span> ignorePlugin = <span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/\.\/locale/</span>,/moment/)</span><br><span class="line"><span class="comment">//3. 包含与排除</span></span><br><span class="line">	exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">	include: path.resolve(<span class="string">'src'</span>)</span><br><span class="line"><span class="comment">//4. 连接库的建立 (和后续webpack.react.js以及 DllPlugin DllReferencePlugin使用)</span></span><br><span class="line"><span class="comment">//5. happypack多线程打包webpack</span></span><br><span class="line"><span class="comment">//6. webpack自带优化</span></span><br><span class="line"><span class="comment">// tree-shaking</span></span><br><span class="line">     <span class="keyword">import</span> calc <span class="keyword">from</span> <span class="string">'./test'</span></span><br><span class="line">     <span class="built_in">console</span>.log(calc.sum(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"> <span class="comment">// import 在生产环境下会自动清除没用的东西</span></span><br><span class="line"> <span class="comment">// 相当于tree-shaking 没用代码自动删除</span></span><br><span class="line"> <span class="comment">// import 可以 但是 require就不行</span></span><br><span class="line"><span class="comment">// scope hosting 作用域提升  </span></span><br><span class="line">      <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line">      <span class="keyword">let</span> b = <span class="number">2</span></span><br><span class="line">      <span class="keyword">let</span> c = <span class="number">3</span></span><br><span class="line">      <span class="keyword">let</span> d = a+b+c <span class="comment">//webpack会自动省略可以简化的代码</span></span><br><span class="line">   <span class="built_in">console</span>.log(d+<span class="string">'------'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="抽取公共代码"><a class="markdownIt-Anchor" href="#抽取公共代码"></a> 抽取公共代码</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js中的配置  抽取公共模块</span></span><br><span class="line"><span class="comment">// index引入 a b   other也引入 a b</span></span><br><span class="line">optimization: &#123;</span><br><span class="line">splitChunks:&#123;  <span class="comment">//分割代码块</span></span><br><span class="line">cacheGrops:&#123;  <span class="comment">//缓存组</span></span><br><span class="line">  common:&#123;    <span class="comment">//公共模块 </span></span><br><span class="line">    chunks: <span class="string">'initial'</span>,  <span class="comment">//入口从哪找</span></span><br><span class="line">    minSize: <span class="number">0</span> , <span class="comment">//大于0个字节</span></span><br><span class="line">    minChunks: <span class="number">0</span> <span class="comment">//引用0次</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">vendor: &#123;  <span class="comment">//抽离第三方模块 比如jquery</span></span><br><span class="line">  priority: <span class="number">1</span>, <span class="comment">//先抽离第三方模块</span></span><br><span class="line">  test: <span class="regexp">/node_modules/</span>, <span class="comment">//引入</span></span><br><span class="line">  chunks: <span class="string">'initial'</span>,  <span class="comment">//</span></span><br><span class="line">  minSize: <span class="number">0</span> , <span class="comment">//</span></span><br><span class="line">  minChunks: <span class="number">0</span> <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="webpack懒加载"><a class="markdownIt-Anchor" href="#webpack懒加载"></a> webpack懒加载</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需要babel配置 (@babel/plugin-syntax-dynamic-import)</span></span><br><span class="line"><span class="comment">// 生成 两个文件  用另一个时候再加载  （http访问）</span></span><br><span class="line"><span class="keyword">let</span> button = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>)</span><br><span class="line">button.innerHTML = <span class="string">'hello'</span></span><br><span class="line"><span class="comment">//vue react懒加载 都是这样</span></span><br><span class="line">button.addEventListener(<span class="string">'click'</span>,()=&gt;&#123;</span><br><span class="line"><span class="comment">//es6草案中的语法 实现jsonp动态加载文件</span></span><br><span class="line"><span class="keyword">import</span> (<span class="string">'./source.js'</span>) .then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(data.default)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.body.append(button)</span><br></pre></td></tr></table></figure>
<h3 id="webpack热更新"><a class="markdownIt-Anchor" href="#webpack热更新"></a> webpack热更新</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//热更新的概念  只更新页面的一部分 不全部更新</span></span><br><span class="line"><span class="keyword">import</span> str <span class="keyword">from</span> <span class="string">'./source.js'</span></span><br><span class="line"><span class="built_in">console</span>.log(str)</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">module</span>.hot) &#123;</span><br><span class="line"><span class="built_in">module</span>.hot.accept(<span class="string">'./source.js'</span>,()=&gt;&#123;</span><br><span class="line"> <span class="comment">//import只能写在页面的顶端</span></span><br><span class="line"> <span class="keyword">let</span> str = <span class="built_in">require</span>(<span class="string">'./source.js'</span>)</span><br><span class="line"> <span class="built_in">console</span>.log(str.default)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="webpackconfigjs-2"><a class="markdownIt-Anchor" href="#webpackconfigjs-2"></a> webpack.config.js</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模块 happypack 来多线程打包webpack  进程（node中线程与进程关系） 打包文件会加快（文件很小时可能会变慢）</span></span><br><span class="line"><span class="comment">// const Happypack = require('happypack')</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">	template: <span class="string">'./public/index.html'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//webpack自带的IgnorePlugin 忽略掉moment中locale引入的东西</span></span><br><span class="line"><span class="keyword">const</span> ignorePlugin = <span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/\.\/locale/</span>,/moment/)</span><br><span class="line"></span><br><span class="line"><span class="comment">//webpack自带的             动态引入链接库</span></span><br><span class="line"><span class="keyword">const</span> dllReferencePlugin = <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">	manifest: path.resolve(__dirname,<span class="string">'dist'</span>,<span class="string">'manifest.json'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//  happyplugin配置</span></span><br><span class="line"><span class="comment">// const happyPlugin = new Happypack(&#123;</span></span><br><span class="line"><span class="comment">//   id:'js',</span></span><br><span class="line"><span class="comment">//   use: [&#123;</span></span><br><span class="line"><span class="comment">//     loader:'babel-loader',</span></span><br><span class="line"><span class="comment">//     options: &#123;</span></span><br><span class="line"><span class="comment">//       presets: [</span></span><br><span class="line"><span class="comment">//       '@babel/preset-env',</span></span><br><span class="line"><span class="comment">//       '@babel/preset-react',</span></span><br><span class="line"><span class="comment">//       ]</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;]</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 热更新所需插件</span></span><br><span class="line"><span class="keyword">const</span> hotPlugin = <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line"><span class="keyword">const</span> namePlugin = <span class="keyword">new</span> webpack.NamedModulesPlugin() <span class="comment">//打印名字</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">mode: <span class="string">"development"</span>,</span><br><span class="line"><span class="comment">/* optimization: &#123;</span></span><br><span class="line"><span class="comment">splitChunks:&#123;  //分割代码块</span></span><br><span class="line"><span class="comment">cacheGrops:&#123;  //缓存组</span></span><br><span class="line"><span class="comment">  common:&#123;    //公共模块 </span></span><br><span class="line"><span class="comment">    chunks: 'initial',  //入口从哪找</span></span><br><span class="line"><span class="comment">    minSize: 0 , //大于0个字节</span></span><br><span class="line"><span class="comment">    minChunks: 0 //引用0次</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;,</span></span><br><span class="line"><span class="comment">vendor: &#123;  //抽离第三方模块</span></span><br><span class="line"><span class="comment">  priority: 1, //先抽离第三方模块</span></span><br><span class="line"><span class="comment">  test: /node_modules/, //引入</span></span><br><span class="line"><span class="comment">  chunks: 'initial',  //入口从哪找</span></span><br><span class="line"><span class="comment">  minSize: 0 , //大于0个字节</span></span><br><span class="line"><span class="comment">  minChunks: 0 //引用0次</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;, */</span></span><br><span class="line">entry: &#123;</span><br><span class="line">index:<span class="string">'./src/index.js'</span>,</span><br><span class="line"><span class="comment">//测试抽取公共代码用</span></span><br><span class="line"><span class="comment">// other:'./src/other.js'</span></span><br><span class="line">&#125;,</span><br><span class="line">output: &#123;</span><br><span class="line">filename: <span class="string">'index.js'</span>,</span><br><span class="line">path: path.resolve(__dirname,<span class="string">'dist'</span>),</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//在package.json中配置 好像不起作用  不知道为啥子 不默认打开dist目录 先用这种方法吧</span></span><br><span class="line">devServer:&#123;</span><br><span class="line"><span class="comment">//热更新</span></span><br><span class="line">hot: <span class="literal">true</span>,</span><br><span class="line">port: <span class="number">3000</span>,</span><br><span class="line">open: <span class="literal">true</span>,</span><br><span class="line">contentBase: <span class="string">'./dist'</span></span><br><span class="line">&#125;,</span><br><span class="line">plugins: [</span><br><span class="line">htmlPlugin,</span><br><span class="line"><span class="comment">//忽略插件</span></span><br><span class="line">ignorePlugin,</span><br><span class="line"><span class="comment">//引入链接库插件</span></span><br><span class="line">dllReferencePlugin,</span><br><span class="line"><span class="comment">//多线程打包文件 </span></span><br><span class="line"><span class="comment">// happyPlugin</span></span><br><span class="line"><span class="comment">// 热更新的两个插件</span></span><br><span class="line">hotPlugin,</span><br><span class="line">namePlugin</span><br><span class="line">],</span><br><span class="line"><span class="built_in">module</span>:&#123;</span><br><span class="line"><span class="comment">//不去解析jquery中的依赖库 </span></span><br><span class="line">noParse: <span class="regexp">/jquery/</span>,</span><br><span class="line">rules:[</span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  <span class="comment">//指定一个id  可能css也需要多线程打包</span></span><br><span class="line">  <span class="comment">// use: 'Happypack/loader?id=js',</span></span><br><span class="line">  use: &#123;</span><br><span class="line">    loader:<span class="string">'babel-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      presets: [</span><br><span class="line">      <span class="string">'@babel/preset-env'</span>,</span><br><span class="line">      <span class="string">'@babel/preset-react'</span>,</span><br><span class="line">      ],</span><br><span class="line">      plugins: [</span><br><span class="line">        <span class="string">'@babel/plugin-syntax-dynamic-import'</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;   </span><br><span class="line">  &#125;,</span><br><span class="line">  exclude: <span class="regexp">/node_modules/</span>     </span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="webpackreactjs输出manifestjson"><a class="markdownIt-Anchor" href="#webpackreactjs输出manifestjson"></a> webpack.react.js(输出manifest.json)</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//webpack自带插件  变成动态链接库</span></span><br><span class="line"><span class="keyword">const</span> dllPlugin = <span class="keyword">new</span> webpack.DllPlugin(&#123; <span class="comment">//name==library</span></span><br><span class="line">   name: <span class="string">'_dll_[name]'</span>,</span><br><span class="line">   <span class="comment">//manifest.json就是一个任务清单</span></span><br><span class="line">   path: path.resolve(__dirname,<span class="string">'dist'</span>,<span class="string">'manifest.json'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">mode: <span class="string">'development'</span>,</span><br><span class="line">entry: &#123;</span><br><span class="line"> <span class="comment">// test: './src/test.js'</span></span><br><span class="line"> react: [<span class="string">'react'</span>,<span class="string">'react-dom'</span>]</span><br><span class="line">&#125;,</span><br><span class="line">output: &#123;</span><br><span class="line"> filename: <span class="string">'_dll_[name].js'</span>, <span class="comment">//产生文件名</span></span><br><span class="line"> path: path.resolve(__dirname,<span class="string">'dist'</span>),</span><br><span class="line"> <span class="comment">//指定 var a = '...'</span></span><br><span class="line"> library: <span class="string">'_dll_[name]'</span>,</span><br><span class="line"> <span class="comment">//配置commonjs 会变成export["ab"] 配置umd会变成umd模式 可配置 commonjs var this 主要用var(默认就是)</span></span><br><span class="line"> <span class="comment">//libraryTarget: 'var'</span></span><br><span class="line">&#125;,</span><br><span class="line">plugins: [</span><br><span class="line"> <span class="comment">//导出 manifest.json 以及 _dll_react.js</span></span><br><span class="line"> dllPlugin</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="tapable"><a class="markdownIt-Anchor" href="#tapable"></a> Tapable</h2>
<blockquote>
<p>介绍：本质是一种事件流的机制，核心是把各个插件串联起来，实现这一核心的就是Tapable，类似于nodejs的events库，采用的发布订阅的模式</p>
</blockquote>
<p><img src="../images/webpack4.assets/Tapable.webp" alt="Tapable"></p>
<p><a href="https://www.jianshu.com/p/273e1c9904d2" target="_blank" rel="noopener">Webpack 核心模块 tapable 解析</a></p>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装tapable</span></span><br><span class="line">yarn add tapable</span><br></pre></td></tr></table></figure>
<h3 id="同步钩子"><a class="markdownIt-Anchor" href="#同步钩子"></a> 同步钩子</h3>
<h4 id="synchook"><a class="markdownIt-Anchor" href="#synchook"></a> SyncHook</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncHook</span></span>&#123; <span class="comment">// 同步的钩子(实现)</span></span><br><span class="line">  <span class="keyword">constructor</span>(args) &#123; <span class="comment">// args 起一个限制作用</span></span><br><span class="line">    <span class="keyword">this</span>.tasks = [];</span><br><span class="line">  &#125;</span><br><span class="line">  tap(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task);</span><br><span class="line">  &#125;</span><br><span class="line">  call(...args)&#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.forEach(<span class="function"><span class="params">task</span>=&gt;</span>task(...args));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> SyncHook([<span class="string">'name'</span>]);</span><br><span class="line">hook.tap(<span class="string">'node'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'node'</span>,name);</span><br><span class="line">&#125;); <span class="comment">// tap用来注册事件的 events.on </span></span><br><span class="line">hook.tap(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'react'</span>, name);</span><br><span class="line">&#125;); </span><br><span class="line">hook.call(<span class="string">'jw'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同步的方法（同步钩子的实例）</span></span><br><span class="line"><span class="keyword">let</span> &#123;SyncHook&#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心就是发布订阅</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lesson</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">      arch: <span class="keyword">new</span> SyncHook([<span class="string">'name'</span>,<span class="string">'age'</span>]) <span class="comment">// 限制绑定函数的参数</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  tap()&#123; <span class="comment">// 希望调用这个方法来在钩子上注册事件</span></span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'node'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123; <span class="comment">// 第一个参数是注释作用 没有实际意义</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'node'</span>, name);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'node'</span>, name);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  start()&#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.call(<span class="string">'jw'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> Lesson();</span><br><span class="line">l.tap();</span><br><span class="line">l.start();</span><br></pre></td></tr></table></figure>
<h4 id="syncbailhook"><a class="markdownIt-Anchor" href="#syncbailhook"></a> SyncBailHook</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncBailHook</span></span>&#123; <span class="comment">// 同步的钩子(实现)</span></span><br><span class="line">  <span class="keyword">constructor</span>(args) &#123; <span class="comment">// args 起一个限制作用</span></span><br><span class="line">    <span class="keyword">this</span>.tasks = [];</span><br><span class="line">  &#125;</span><br><span class="line">  tap(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task);</span><br><span class="line">  &#125;</span><br><span class="line">  call(...args)&#123;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>; <span class="comment">// 取任务队列中的第一个</span></span><br><span class="line">    <span class="keyword">let</span> ret;</span><br><span class="line">    <span class="keyword">do</span>&#123; <span class="comment">// 至少做一次</span></span><br><span class="line">      ret = <span class="keyword">this</span>.tasks[index++](...args);</span><br><span class="line">    &#125;<span class="keyword">while</span>(ret === <span class="literal">undefined</span> &amp;&amp; index &lt; <span class="keyword">this</span>.tasks.length)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> SyncBailHook([<span class="string">'name'</span>]);</span><br><span class="line">hook.tap(<span class="string">'node'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'node'</span>,name);</span><br><span class="line"> <span class="comment">// return '停一停有事'</span></span><br><span class="line">&#125;); <span class="comment">// tap用来注册事件的 events.on </span></span><br><span class="line">hook.tap(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'react'</span>, name);</span><br><span class="line">&#125;); </span><br><span class="line">hook.call(<span class="string">'jw'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="-2"><a class="markdownIt-Anchor" href="#-2"></a> </h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同步的方法（同步钩子的实例）</span></span><br><span class="line"><span class="keyword">let</span> &#123;SyncBailHook&#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"><span class="comment">// Bail保险 熔断型的</span></span><br><span class="line"><span class="comment">// 核心就是发布订阅</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lesson</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">      arch: <span class="keyword">new</span> SyncBailHook([<span class="string">'name'</span>,<span class="string">'age'</span>]) <span class="comment">// 限制绑定函数的参数</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  tap()&#123; <span class="comment">// 希望调用这个方法来在钩子上注册事件</span></span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'node'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123; <span class="comment">// 第一个参数是注释作用 没有实际意义</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'node'</span>, name);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 如果当前函数有返回值则不会继续执行</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'react'</span>, name);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  start()&#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.call(<span class="string">'jw'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> Lesson();</span><br><span class="line">l.tap();</span><br><span class="line">l.start();</span><br></pre></td></tr></table></figure>
<h4 id="syncwaterfallhook"><a class="markdownIt-Anchor" href="#syncwaterfallhook"></a> SyncWaterfallHook</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncWaterfallHook</span></span>&#123; <span class="comment">// 同步的钩子(实现)</span></span><br><span class="line">  <span class="keyword">constructor</span>(args) &#123; </span><br><span class="line">    <span class="keyword">this</span>.tasks = [];</span><br><span class="line">  &#125;</span><br><span class="line">  tap(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task);</span><br><span class="line">  &#125;</span><br><span class="line">  call(...args)&#123;</span><br><span class="line">    <span class="keyword">let</span> [first,...others] = <span class="keyword">this</span>.tasks;</span><br><span class="line">    <span class="comment">// first就是第一个任务</span></span><br><span class="line">    <span class="comment">// reduce</span></span><br><span class="line">    others.reduce(<span class="function">(<span class="params">prev,next</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> next(prev);</span><br><span class="line">    &#125;, first(...args))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> SyncWaterfallHook([<span class="string">'name'</span>]);</span><br><span class="line">hook.tap(<span class="string">'node'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'node'</span>,name);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'node还不错'</span></span><br><span class="line">&#125;); </span><br><span class="line">hook.tap(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'react'</span>, data);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'react ok'</span></span><br><span class="line">&#125;); </span><br><span class="line">hook.tap(<span class="string">'webpack'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'webpack'</span>, data);</span><br><span class="line">&#125;); </span><br><span class="line">hook.call(<span class="string">'jw'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="-3"><a class="markdownIt-Anchor" href="#-3"></a> </h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同步的方法（同步钩子的实例）</span></span><br><span class="line"><span class="keyword">let</span> &#123;SyncWaterfallHook&#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"><span class="comment">// 瀑布的意思就是上一个监听函数的结果是下一个人的输入</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lesson</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">      arch: <span class="keyword">new</span> SyncWaterfallHook([<span class="string">'name'</span>,<span class="string">'age'</span>]) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  tap()&#123; <span class="comment">// 希望调用这个方法来在钩子上注册事件</span></span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'node'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'node'</span>, name);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'node学的不错'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'react'</span>, data);</span><br><span class="line">      <span class="keyword">return</span>  <span class="string">'react 更好'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'webpack'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'webpack'</span>, data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  start()&#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.call(<span class="string">'jw'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> Lesson();</span><br><span class="line">l.tap();</span><br><span class="line">l.start();</span><br></pre></td></tr></table></figure>
<h4 id="syncloophook"><a class="markdownIt-Anchor" href="#syncloophook"></a> SyncLoopHook</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncLoopHook</span></span>&#123; <span class="comment">// 同步的钩子(实现)</span></span><br><span class="line">  <span class="keyword">constructor</span>(args) &#123; </span><br><span class="line">    <span class="keyword">this</span>.tasks = [];</span><br><span class="line">  &#125;</span><br><span class="line">  tap(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task);</span><br><span class="line">  &#125;</span><br><span class="line">  call(...args)&#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.forEach(<span class="function"><span class="params">task</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> ret;</span><br><span class="line">      <span class="keyword">do</span>&#123;</span><br><span class="line">        ret = task(...args);</span><br><span class="line">      &#125; <span class="keyword">while</span> (ret !== <span class="literal">undefined</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> SyncLoopHook([<span class="string">'name'</span>]);</span><br><span class="line">hook.tap(<span class="string">'node'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'node'</span>,name);</span><br><span class="line">  <span class="keyword">return</span> ++total == <span class="number">3</span>?<span class="literal">undefined</span> :<span class="string">'1'</span></span><br><span class="line">&#125;); </span><br><span class="line">hook.tap(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'react'</span>, name);</span><br><span class="line">  </span><br><span class="line">&#125;); </span><br><span class="line">hook.call(<span class="string">'jw'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="-4"><a class="markdownIt-Anchor" href="#-4"></a> </h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;SyncLoopHook&#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>); <span class="comment">//（同步钩子的实例）</span></span><br><span class="line"><span class="comment">// 某个监听事件 如果返回了值 这个方法会再次执行，只有返回undefined这个方法才会停止执行</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lesson</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">      arch: <span class="keyword">new</span> SyncLoopHook([<span class="string">'name'</span>,<span class="string">'age'</span>]) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  tap()&#123; </span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'node'</span>,  (name) =&gt; &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'node'</span>, name);</span><br><span class="line">      <span class="keyword">return</span> ++<span class="keyword">this</span>.index == <span class="number">3</span>?<span class="literal">undefined</span>:<span class="string">'再来一次'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'react'</span>,  (data) =&gt;&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'react'</span>, data);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tap(<span class="string">'webpack'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'webpack'</span>, data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  start()&#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.call(<span class="string">'jw'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> Lesson();</span><br><span class="line">l.tap();</span><br><span class="line">l.start();</span><br></pre></td></tr></table></figure>
<h3 id="异步钩子"><a class="markdownIt-Anchor" href="#异步钩子"></a> 异步钩子</h3>
<h4 id="asyncparrallehook"><a class="markdownIt-Anchor" href="#asyncparrallehook"></a> AsyncParralleHook</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncParralleHook</span> </span>&#123; <span class="comment">// AsyncParralleHook 的实现</span></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks = [];</span><br><span class="line">  &#125;</span><br><span class="line">  tapAsync(name, task) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task);</span><br><span class="line">  &#125;</span><br><span class="line">  callAsync(...args) &#123; <span class="comment">// express 中的中间件的原理</span></span><br><span class="line">    <span class="keyword">let</span> finalCallback = args.pop();</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>; <span class="comment">// Promise.all方法</span></span><br><span class="line">    <span class="keyword">let</span> done = <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 提供给用户一个done方法</span></span><br><span class="line">      index++;</span><br><span class="line">      <span class="keyword">if</span> (index === <span class="keyword">this</span>.tasks.length) finalCallback();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.tasks.forEach(<span class="function"><span class="params">task</span> =&gt;</span> task(...args, done));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实例</span></span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> AsyncParralleHook([<span class="string">'name'</span>]);</span><br><span class="line">hook.tapAsync(<span class="string">'node'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'node'</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">hook.tapAsync(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'react'</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">hook.callAsync(<span class="string">'jw'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'all'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>AsyncParralleHook 的示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; AsyncParallelHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"><span class="comment">// 异步的钩子（串行）并行 需要等待所有并发的异步时间执行后再执行回调函数</span></span><br><span class="line"><span class="comment">// 同时发送多个请求</span></span><br><span class="line"><span class="comment">// tapable库中有3种注册方法为 tap（同步）、tapAsync（异步）、tapPromise(注册的是promise)</span></span><br><span class="line"><span class="comment">// call、callAsync、promise</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lesson</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">      arch: <span class="keyword">new</span> AsyncParallelHook([<span class="string">'name'</span>])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  tap() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tapAsync(<span class="string">'react'</span>, (name, cb) =&gt; &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'react'</span>, name);</span><br><span class="line">        cb(<span class="string">'出错了'</span>); <span class="comment">// BailHook</span></span><br><span class="line">      &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tapAsync(<span class="string">'react'</span>, (name, cb) =&gt; &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'react'</span>, name);</span><br><span class="line">        cb();</span><br><span class="line">      &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  start() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.callAsync(<span class="string">'jw'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'end'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> Lesson();</span><br><span class="line">l.tap();</span><br><span class="line">l.start();</span><br></pre></td></tr></table></figure>
<h4 id="asyncparrallehookpromise"><a class="markdownIt-Anchor" href="#asyncparrallehookpromise"></a> AsyncParralleHook（promise）</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let &#123;AsyncParralleHook&#125; = require('tapable');</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定事件的三种方式 tap 绑定同步 tapAsync 异步的 tapPromise</span></span><br><span class="line"><span class="comment">//                  call         callAsync      promise</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncParralleHook</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks = [];</span><br><span class="line">  &#125;</span><br><span class="line">  tapPromise(name, task) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task);</span><br><span class="line">  &#125;</span><br><span class="line">  promise(...args) &#123; <span class="comment">// express 中的中间件的原理</span></span><br><span class="line">   <span class="keyword">let</span> promises = <span class="keyword">this</span>.tasks.map(<span class="function"><span class="params">task</span>=&gt;</span>task());</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">Promise</span>.all(promises)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 示例</span></span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> AsyncParralleHook([<span class="string">'name'</span>]);</span><br><span class="line">hook.tapPromise(<span class="string">'node'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'node'</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">hook.tapPromise(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'react'</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">hook.promise(<span class="string">'jw'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'all'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="asyncparallelbailhookpromise的示例"><a class="markdownIt-Anchor" href="#asyncparallelbailhookpromise的示例"></a> AsyncParallelBailHook（promise）的示例</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; AsyncParallelBailHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>); <span class="comment">// 实现AsyncParallelBailHook</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lesson</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">      arch: <span class="keyword">new</span> AsyncParallelBailHook([<span class="string">'name'</span>])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  tap() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tapPromise(<span class="string">'react'</span>, (name) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'react'</span>, name);</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tapPromise(<span class="string">'node'</span>, (name) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'node'</span>, name);</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  start() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.promise(<span class="string">'jw'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'end'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> Lesson();</span><br><span class="line">l.tap();</span><br><span class="line">l.start();</span><br></pre></td></tr></table></figure>
<h4 id="asyncserieshook"><a class="markdownIt-Anchor" href="#asyncserieshook"></a> AsyncSeriesHook</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncSeriesHook</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(args) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//实现tapAsync</span></span><br><span class="line">  tapAsync(name,task) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task)</span><br><span class="line">  &#125;</span><br><span class="line">  callAsync(...args) &#123;</span><br><span class="line">    <span class="keyword">let</span> finalCallback = args.pop()</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> next = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(index === <span class="keyword">this</span>.tasks.length) <span class="keyword">return</span> finalCallback()</span><br><span class="line">      <span class="keyword">let</span> task = <span class="keyword">this</span>.tasks[index++]</span><br><span class="line">      task(...args,next)</span><br><span class="line">    &#125;</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> h = <span class="keyword">new</span> AsyncSeriesHook ()</span><br><span class="line">h.tapAsync(<span class="string">'node'</span>,(name,cb)=&gt;&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'node'</span>,name)</span><br><span class="line">    <span class="comment">//cb()对应着 next</span></span><br><span class="line">    cb()</span><br><span class="line">  &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">h.tapAsync(<span class="string">'react'</span>,(name,cb)=&gt;&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'react'</span>,name)</span><br><span class="line">    cb()</span><br><span class="line">  &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">h.callAsync(<span class="string">'hanke'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="asyncserieshookpromise"><a class="markdownIt-Anchor" href="#asyncserieshookpromise"></a> AsyncSeriesHook（promise）</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncSeriesHook</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks = [];</span><br><span class="line">  &#125;</span><br><span class="line">  tapPromise(name, task) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task);</span><br><span class="line">  &#125;</span><br><span class="line">  promise(...args) &#123; </span><br><span class="line">    <span class="keyword">let</span> [first,...others] = <span class="keyword">this</span>.tasks;</span><br><span class="line">    <span class="keyword">return</span> others.reduce(<span class="function">(<span class="params">p,n</span>)=&gt;</span>&#123; <span class="comment">// 跟redux源码类似</span></span><br><span class="line">      <span class="keyword">return</span> p.then(<span class="function"><span class="params">()</span>=&gt;</span>n()); <span class="comment">// 把所有的promise串连起来</span></span><br><span class="line">    &#125;, first(...args));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'name'</span>]);</span><br><span class="line">hook.tapPromise(<span class="string">'node'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'node'</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">hook.tapPromise(<span class="string">'react'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'react'</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">hook.promise(<span class="string">'jw'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'all'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>AsyncSeriesHook（promise）的示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; AsyncSeriesHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"><span class="comment">// AsyncSeriesHook 串行执行 tapAsync + callAsync</span></span><br><span class="line"><span class="comment">//                         tapPromise + promise</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lesson</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">      arch: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'name'</span>])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  tap() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tapPromise(<span class="string">'react'</span>, (name) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'react'</span>, name);</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tapPromise(<span class="string">'node'</span>, (name) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'node'</span>, name);</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  start() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.promise(<span class="string">'jw'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'end'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> Lesson();</span><br><span class="line">l.tap();</span><br><span class="line">l.start();</span><br></pre></td></tr></table></figure>
<h4 id="asyncserieswaterfallhook"><a class="markdownIt-Anchor" href="#asyncserieswaterfallhook"></a> AsyncSeriesWaterfallHook</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncSeriesWaterfallHook</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(args) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//实现tapPomise</span></span><br><span class="line">  tapPromise(name,task) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task)</span><br><span class="line">  &#125;</span><br><span class="line">  promise(...arg)&#123;</span><br><span class="line">    <span class="comment">//redux源码类似（还没开始学习呢）  真的太强了  我完全想不出来  </span></span><br><span class="line">    <span class="comment">// 简直无敌啊</span></span><br><span class="line">    <span class="keyword">let</span> [first,...others] = <span class="keyword">this</span>.tasks</span><br><span class="line">    <span class="keyword">return</span> others.reduce(<span class="function">(<span class="params">promise,next</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> promise.then(<span class="function"><span class="params">data</span>=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(data===<span class="literal">undefined</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> next(...arg)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> next(data)</span><br><span class="line">        &#125;  </span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,first(...arg))     </span><br><span class="line">  &#125;</span><br><span class="line">  tapAsync(name,task) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(task)</span><br><span class="line">  &#125;</span><br><span class="line">  callAsync(...args) &#123;</span><br><span class="line">    <span class="keyword">let</span> finalCallback = args.pop()</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> next = <span class="function">(<span class="params">err,data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> task = <span class="keyword">this</span>.tasks[index]</span><br><span class="line">      <span class="keyword">if</span>(!task || err===<span class="string">'error'</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> finalCallback()</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(index===<span class="number">0</span>) &#123;</span><br><span class="line">          task(...args,next)</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span>(data===<span class="literal">undefined</span>)&#123;</span><br><span class="line">            task(...args,next)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            task(data,next)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      index++</span><br><span class="line">    &#125;</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> h = <span class="keyword">new</span> AsyncSeriesWaterfallHook ()</span><br><span class="line"><span class="comment">/* h.tapAsync('node',(name,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">  setTimeout(()=&gt;&#123;</span></span><br><span class="line"><span class="comment">    console.log('node',name)</span></span><br><span class="line"><span class="comment">    //cb()对应着 next</span></span><br><span class="line"><span class="comment">    cb(null,'结果')</span></span><br><span class="line"><span class="comment">  &#125;,1000)</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">h.tapAsync('react',(name,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">  setTimeout(()=&gt;&#123;</span></span><br><span class="line"><span class="comment">    console.log('react',name)</span></span><br><span class="line"><span class="comment">    cb()</span></span><br><span class="line"><span class="comment">  &#125;,1000)</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">h.callAsync('hanke',function()&#123;</span></span><br><span class="line"><span class="comment">  console.log('end')</span></span><br><span class="line"><span class="comment">&#125;) */</span></span><br><span class="line">h.tapPromise(<span class="string">'node'</span>,name=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'node'</span>,name)</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">h.tapPromise(<span class="string">'react'</span>,name=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'react'</span>,name)</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">h.promise(<span class="string">'hanke'</span>).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>AsyncSeriesWaterfallHook 的示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; AsyncSeriesWaterfallHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步串行 先执行完一个再执行下一个 类似于express中间件 先执行完才可以再执行0</span></span><br><span class="line"><span class="comment">// tapAsync  tapPromise都可以</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lesson</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">      arch: <span class="keyword">new</span> AsyncSeriesWaterfallHook([<span class="string">'name'</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.index = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//发布订阅的方式  这个得认真学一学</span></span><br><span class="line">  <span class="comment">//异步方法的第一种 tapAsync</span></span><br><span class="line">  <span class="comment">/* tap() &#123;   //注册 监听函数</span></span><br><span class="line"><span class="comment">    this.hooks.arch.tapAsync('node',(name,cb) =&gt; &#123;</span></span><br><span class="line"><span class="comment">      setTimeout(()=&gt;&#123;</span></span><br><span class="line"><span class="comment">        console.log('node',name)</span></span><br><span class="line"><span class="comment">        cb()</span></span><br><span class="line"><span class="comment">      &#125;,1000)</span></span><br><span class="line"><span class="comment">    &#125;)</span></span><br><span class="line"><span class="comment">    this.hooks.arch.tapAsync('react',(name,cb) =&gt; &#123;</span></span><br><span class="line"><span class="comment">      setTimeout(()=&gt;&#123;</span></span><br><span class="line"><span class="comment">        console.log('react',name)</span></span><br><span class="line"><span class="comment">        cb()</span></span><br><span class="line"><span class="comment">      &#125;,1000)</span></span><br><span class="line"><span class="comment">    &#125;)</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">  start() &#123;</span></span><br><span class="line"><span class="comment">    this.hooks.arch.callAsync('hanke',function()&#123;</span></span><br><span class="line"><span class="comment">      console.log("end")</span></span><br><span class="line"><span class="comment">    &#125;)</span></span><br><span class="line"><span class="comment">  &#125; */</span></span><br><span class="line">  tap() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tapPromise(<span class="string">'node'</span>, name =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'node'</span>, name)</span><br><span class="line">          resolve(<span class="string">'err'</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.tapPromise(<span class="string">'react'</span>, name =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'react'</span>, name)</span><br><span class="line">          resolve()</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  start() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.arch.promise(<span class="string">'hanke'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"end"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> lesson()</span><br><span class="line">l.tap() <span class="comment">//注册这两个事件</span></span><br><span class="line">l.start() <span class="comment">//启动钩子函数</span></span><br></pre></td></tr></table></figure>
<h2 id="手写-webpack"><a class="markdownIt-Anchor" href="#手写-webpack"></a> 手写 webpack</h2>
<blockquote>
<p>示例项目：<a href="https://github.com/cheungww/hanke-webpack" target="_blank" rel="noopener">https://github.com/cheungww/hanke-webpack</a></p>
</blockquote>
<h3 id="项目目录"><a class="markdownIt-Anchor" href="#项目目录"></a> 项目目录</h3>
<blockquote>
<p>手写webpack项目目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; hanke-webpack</span><br><span class="line">&gt; ├── bin</span><br><span class="line">&gt; │   └── hanke-webpack.js</span><br><span class="line">&gt; ├── lib</span><br><span class="line">&gt; │   └── Compiler.js</span><br><span class="line">&gt; └── package.json</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>要使用 手写webpack 的项目目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; webpack-dev</span><br><span class="line">&gt; ├── node_modules</span><br><span class="line">&gt; │   └── </span><br><span class="line">&gt; ├── src</span><br><span class="line">&gt; └── package.json</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote></blockquote>
<h3 id="安装-3"><a class="markdownIt-Anchor" href="#安装-3"></a> 安装</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cnpm i webpack webpack-cli -D</span><br><span class="line"><span class="meta">#</span><span class="bash">如果 之前没有安装过 npx</span></span><br><span class="line">npm i npx -g</span><br><span class="line"><span class="meta">#</span><span class="bash">安装 babelon 把源码解析成AST @babel/traverse  遍历节点 @babel-types 节点替换 @babel-generator 生成</span></span><br><span class="line">cnpm i babylon @babel/traverse @babel/types @babel/generator</span><br><span class="line"><span class="meta">#</span><span class="bash">安装ejs来渲染模板(类似于tempalte-active)</span></span><br><span class="line">cnpm i ejs</span><br><span class="line"><span class="meta">#</span><span class="bash">安装less 来测试loader</span></span><br><span class="line">cnpm i less</span><br><span class="line"><span class="meta">#</span><span class="bash">安装tapable 来测试plugins</span></span><br><span class="line">cnpm i tapable</span><br></pre></td></tr></table></figure>
<h3 id="packagejson"><a class="markdownIt-Anchor" href="#packagejson"></a> package.json</h3>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; //  hanke-webpack/package.json</span><br><span class="line">&gt; &quot;bin&quot;:&#123;</span><br><span class="line">&gt;  &quot;hanke-webpack&quot;: &quot;./bin/hanke-webpack.js&quot;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>bin相当于运行哪一个命令，执行哪一个文件</p>
</blockquote>
<h3 id="npm-link的流程"><a class="markdownIt-Anchor" href="#npm-link的流程"></a> npm link的流程</h3>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment">#在hanke-webpack目录下  注意package.json中的bin配置以及后边是bin目录下的hanke-webpack.js </span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> npm link </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment"># 运行结果为：C:\Users\zww\AppData\Roaming\npm\node_modules\hanke-webpack -&gt; C:\Users\zww\Desktop\fe\webpack\hanke-webpack</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment"># 即 npm 全局的安装路径下的node_modules\hanke-webpack 指向了 自定义的hanke-webpack目录</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment">#在webpack-dev下</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> npm link hanke-webpack </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment"># 运行结果为：C:\Users\zww\Desktop\fe\webpack\webpack-dev\node_modules\hanke-webpack -&gt; C:\Users\zww\AppData\Roaming\npm\node_modules\hanke-webpack -&gt; C:\Users\zww\Desktop\fe\webpack\hanke-webpack</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment"># 即 项目中hanke-webpack模块 指向了 npm 全局的安装路径下的node_modules\hanke-webpack，而全局下的node_modules\hanke-webpack 又指向了 自定义的hanke-webpack目录</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment">#注意 这样npm link后可以直接使用hanke-webpack.cmd  就可以在webpack-go5下边运行了</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="hanke-webpackjs最开始配置"><a class="markdownIt-Anchor" href="#hanke-webpackjs最开始配置"></a> hanke-webpack.js最开始配置</h3>
<blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment">//  这里实际上就是 在自己电脑 nodejs中的global (npm link 后)添加了一个 hanke-webpack.cmd 和一个 hanke-webpack文件  然后 可以 hanke-webpack这样直接执行 </span></span><br><span class="line">&gt; <span class="comment">// 因为路径写错了导致一直出错</span></span><br><span class="line">&gt; #! F:<span class="regexp">/nodejs/</span>node.exe   <span class="comment">//这里对应着自己node的下载地方</span></span><br><span class="line">&gt; <span class="comment">/* 1、需要找到当前执行配置的项目路径，拿到webpack.config.js的配置*/</span></span><br><span class="line">&gt; <span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment">// 导入 config配置文件（即 webpack.config.js）</span></span><br><span class="line">&gt; <span class="keyword">let</span> config = <span class="built_in">require</span>(path.resolve(<span class="string">'webpack.config.js'</span>))</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">let</span> Compiler = <span class="built_in">require</span>(<span class="string">'../lib/Compiler'</span>)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">let</span> compiler = <span class="keyword">new</span> Compiler(config)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment">//入口函数</span></span><br><span class="line">&gt; compiler.hooks.entryOption.call()</span><br><span class="line">&gt; <span class="comment">// 标识运行编译</span></span><br><span class="line">&gt; compiler.run()</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="compilejs"><a class="markdownIt-Anchor" href="#compilejs"></a> compile.js</h3>
<blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">&gt; <span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line">&gt; <span class="keyword">const</span> babylon = <span class="built_in">require</span>(<span class="string">'babylon'</span>)</span><br><span class="line">&gt; <span class="keyword">const</span> types = <span class="built_in">require</span>(<span class="string">'@babel/types'</span>)</span><br><span class="line">&gt; <span class="comment">//es6模块  需要.defalut</span></span><br><span class="line">&gt; <span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">'@babel/traverse'</span>).default</span><br><span class="line">&gt; <span class="keyword">const</span> generator = <span class="built_in">require</span>(<span class="string">'@babel/generator'</span>).default</span><br><span class="line">&gt; <span class="comment">//babelon 把源码解析成AST 可在 https://astexplorer.net/ 查看 ast的导出</span></span><br><span class="line">&gt; <span class="comment">//@babel/traverse   遍历节点</span></span><br><span class="line">&gt; <span class="comment">//@babel/types   节点替换</span></span><br><span class="line">&gt; <span class="comment">//@babel/generator 生成</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">const</span> &#123;SyncHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line">&gt; <span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">'ejs'</span>)</span><br><span class="line">&gt; <span class="comment">//引入ejs</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">Compiler</span></span>&#123;</span><br><span class="line">&gt;   <span class="keyword">constructor</span>(config)&#123;</span><br><span class="line">&gt;     <span class="comment">// entry output</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.config = config</span><br><span class="line">&gt;     <span class="comment">// 保存文件路径</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.entryId <span class="comment">//'./src/index.js'</span></span><br><span class="line">&gt;     <span class="comment">// 保存所有模块依赖</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.modules = &#123;&#125;</span><br><span class="line">&gt;     <span class="comment">// 入口路径</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.entry = config.entry</span><br><span class="line">&gt;     <span class="comment">//可能输出多个文件</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.assets = &#123;&#125;</span><br><span class="line">&gt;     <span class="comment">//表示 工作路径</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.root = process.cwd()</span><br><span class="line">&gt;     </span><br><span class="line">&gt;     <span class="comment">/* ---------- 与 plugin 相关 ----------*/</span></span><br><span class="line">&gt;     <span class="comment">//模拟webpack的生命周期</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">&gt;       entryOption: <span class="keyword">new</span> SyncHook(),</span><br><span class="line">&gt;       compile: <span class="keyword">new</span> SyncHook(),</span><br><span class="line">&gt;       afterCompile: <span class="keyword">new</span> SyncHook(),</span><br><span class="line">&gt;       afterPlugins: <span class="keyword">new</span> SyncHook(),</span><br><span class="line">&gt;       run: <span class="keyword">new</span> SyncHook(),</span><br><span class="line">&gt;       emit: <span class="keyword">new</span> SyncHook(),</span><br><span class="line">&gt;       done: <span class="keyword">new</span> SyncHook()</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     <span class="keyword">let</span> plugins = <span class="keyword">this</span>.config.plugins</span><br><span class="line">&gt;     <span class="comment">//如果是数组</span></span><br><span class="line">&gt;     <span class="keyword">if</span>(<span class="built_in">Array</span>.isArray(plugins))&#123;</span><br><span class="line">&gt;       plugins.forEach(<span class="function"><span class="params">plugin</span>=&gt;</span>&#123;</span><br><span class="line">&gt;         plugin.apply(<span class="keyword">this</span>)</span><br><span class="line">&gt;       &#125;)</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     <span class="keyword">this</span>.hooks.afterPlugins.call()</span><br><span class="line">&gt;     </span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   </span><br><span class="line">&gt;   <span class="comment">// 得到文件内容</span></span><br><span class="line">&gt;   getSource(modulePath) &#123;  </span><br><span class="line">&gt;     <span class="keyword">let</span> content = fs.readFileSync(modulePath,<span class="string">'utf-8'</span>)</span><br><span class="line">&gt;     <span class="comment">//处理 ./index.less</span></span><br><span class="line">&gt;     <span class="keyword">let</span> rules = <span class="keyword">this</span>.config.module.rules</span><br><span class="line">&gt;     rules.forEach(<span class="function"><span class="params">rule</span>=&gt;</span>&#123;</span><br><span class="line">&gt;       <span class="keyword">let</span> &#123;test,use&#125; = rule</span><br><span class="line">&gt;       <span class="keyword">let</span> len = use.length - <span class="number">1</span></span><br><span class="line">&gt;       </span><br><span class="line">&gt;       <span class="comment">/* ---------- 与 loader 相关 ----------*/</span></span><br><span class="line">&gt;       <span class="keyword">if</span>(test.test(modulePath))&#123; <span class="comment">// 正则匹配这个模块是否需要通过loader来转化</span></span><br><span class="line">&gt;         <span class="comment">// loader获取对应的loader函数</span></span><br><span class="line">&gt;         (<span class="function"><span class="keyword">function</span> <span class="title">normalLoader</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&gt;           <span class="comment">//后边是一个绝对路径</span></span><br><span class="line">&gt;           <span class="keyword">let</span> loader = <span class="built_in">require</span>(use[len--])</span><br><span class="line">&gt;           content = loader(content)</span><br><span class="line">&gt;           <span class="comment">// 递归调用loader实现转化功能</span></span><br><span class="line">&gt;             <span class="keyword">if</span>(len&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">&gt;               normalLoader()</span><br><span class="line">&gt;             &#125;</span><br><span class="line">&gt;         &#125;)()</span><br><span class="line">&gt;        </span><br><span class="line">&gt;       &#125;</span><br><span class="line">&gt;     &#125;)</span><br><span class="line">&gt;     </span><br><span class="line">&gt;     <span class="keyword">return</span> content</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   </span><br><span class="line">&gt;   <span class="comment">// 解析源码</span></span><br><span class="line">&gt;   parse(source,parentPath) &#123; <span class="comment">//主要靠AST解析语法树</span></span><br><span class="line">&gt;     <span class="keyword">let</span> ast = babylon.parse(source)</span><br><span class="line">&gt;     <span class="keyword">let</span> dependencies =  []<span class="comment">//数组依赖</span></span><br><span class="line">&gt;     traverse(ast,&#123;</span><br><span class="line">&gt;       <span class="comment">// 调用表达式  a执行  require执行</span></span><br><span class="line">&gt;       CallExpression(p)&#123;</span><br><span class="line">&gt;         <span class="keyword">let</span> node = p.node <span class="comment">//对应的节点</span></span><br><span class="line">&gt;         <span class="keyword">if</span>(node.callee.name === <span class="string">'require'</span>) &#123;</span><br><span class="line">&gt;           node.callee.name = <span class="string">'__webpack_require__'</span></span><br><span class="line">&gt;           <span class="keyword">let</span> moduleName = node.arguments[<span class="number">0</span>].value <span class="comment">// 取到的就是模块的引用名字</span></span><br><span class="line">&gt;           moduleName = moduleName + (path.extname(moduleName)? <span class="string">''</span>:<span class="string">'.js'</span>)</span><br><span class="line">&gt;           moduleName = <span class="string">'./'</span> + path.join(parentPath,moduleName) <span class="comment">//'src/a.js'</span></span><br><span class="line">&gt;           dependencies.push(moduleName)</span><br><span class="line">&gt;           <span class="comment">//节点替换</span></span><br><span class="line">&gt;           node.arguments = [types.StringLiteral(moduleName)]</span><br><span class="line">&gt;         &#125;</span><br><span class="line">&gt;       &#125;</span><br><span class="line">&gt;     &#125;)</span><br><span class="line">&gt;     <span class="keyword">let</span> sourceCode = generator(ast).code</span><br><span class="line">&gt;     <span class="keyword">return</span> &#123; sourceCode, dependencies &#125;</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   </span><br><span class="line">&gt;   <span class="comment">// 构建模块</span></span><br><span class="line">&gt;   buildModule(modulePath,isEntry)&#123;</span><br><span class="line">&gt;     <span class="comment">// 获取模块内容</span></span><br><span class="line">&gt;     <span class="keyword">let</span> source = <span class="keyword">this</span>.getSource(modulePath)</span><br><span class="line">&gt;     <span class="comment">// 模块id（即模块的相对路径） moduleName  = modulePath - this.root  // path.relative对应 此方法</span></span><br><span class="line">&gt;     <span class="keyword">let</span> moduleName = <span class="string">'./'</span> + path.relative(<span class="keyword">this</span>.root,modulePath)</span><br><span class="line">&gt;     <span class="keyword">if</span>(isEntry) &#123;</span><br><span class="line">&gt;       <span class="keyword">this</span>.entryId = moduleName <span class="comment">// 保存入口名字</span></span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     </span><br><span class="line">&gt;     <span class="comment">// 解析 需要把source源码进行改造  返回一个依赖列表</span></span><br><span class="line">&gt;     <span class="keyword">let</span> &#123; sourceCode, dependencies &#125; = <span class="keyword">this</span>.parse(source, path.dirname(moduleName))</span><br><span class="line">&gt;     <span class="comment">// 把相对路径和模块中的内容对应起来</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.modules[moduleName] = sourceCode</span><br><span class="line">&gt;     dependencies.forEach(<span class="function"><span class="params">dep</span>=&gt;</span>&#123;</span><br><span class="line">&gt;       <span class="comment">//附模块的加载  递归加载</span></span><br><span class="line">&gt;       <span class="keyword">this</span>.buildModule(dep,<span class="literal">false</span>)</span><br><span class="line">&gt;     &#125;)</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   emitFile() &#123; <span class="comment">//发射文件</span></span><br><span class="line">&gt;     <span class="comment">//数据渲染</span></span><br><span class="line">&gt;     <span class="comment">//看的是webpack.config.js中的output</span></span><br><span class="line">&gt;     fs.access(<span class="keyword">this</span>.config.output.path,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">&gt;       <span class="comment">// 文件和目录不存在的情况下；</span></span><br><span class="line">&gt;       <span class="keyword">if</span>(err)&#123;</span><br><span class="line">&gt;         fs.mkdirSync(<span class="keyword">this</span>.config.output.path);</span><br><span class="line">&gt;         <span class="comment">// 这里只能创建单层目录，而不能创建多层目录，创建多层目录可看</span></span><br><span class="line">&gt;         <span class="comment">// https://blog.csdn.net/m0_37263637/article/details/95640248</span></span><br><span class="line">&gt;       &#125;</span><br><span class="line">&gt;     &#125;)</span><br><span class="line">&gt;     <span class="keyword">let</span> main = path.join(<span class="keyword">this</span>.config.output.path,<span class="keyword">this</span>.config.output.filename)</span><br><span class="line">&gt;     <span class="comment">//读取模板</span></span><br><span class="line">&gt;     <span class="keyword">let</span> templateStr = <span class="keyword">this</span>.getSource(path.join(__dirname,<span class="string">'main.ejs'</span>))</span><br><span class="line">&gt;     <span class="comment">//渲染</span></span><br><span class="line">&gt;     <span class="keyword">let</span> code = ejs.render(templateStr,&#123;<span class="attr">entryId</span>:<span class="keyword">this</span>.entryId,<span class="attr">modules</span>:<span class="keyword">this</span>.modules&#125;)</span><br><span class="line">&gt;     <span class="comment">//拿到输出到哪个目录下</span></span><br><span class="line">&gt;     <span class="comment">//资源中 路径对应的代码</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.assets[main] = code</span><br><span class="line">&gt;     fs.writeFileSync(main,<span class="keyword">this</span>.assets[main])</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   run()&#123;</span><br><span class="line">&gt;     <span class="comment">/* ---------- 与 plugin 相关 ----------*/</span></span><br><span class="line">&gt;     <span class="comment">//执行  解析文件依赖</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.hooks.run.call()</span><br><span class="line">&gt;     <span class="comment">//编译 调用</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.hooks.compile.call()</span><br><span class="line">&gt;     <span class="comment">/* --------------------*/</span></span><br><span class="line">&gt;     </span><br><span class="line">&gt;     <span class="comment">//执行  并且创建模块依赖关系  </span></span><br><span class="line">&gt;     <span class="keyword">this</span>.buildModule(path.resolve(<span class="keyword">this</span>.root,<span class="keyword">this</span>.entry),<span class="literal">true</span>)</span><br><span class="line">&gt;     </span><br><span class="line">&gt;     <span class="comment">/* ---------- 与 plugin 相关 ----------*/</span></span><br><span class="line">&gt;     <span class="comment">// 发射一个文件 打包后的文件</span></span><br><span class="line">&gt;     <span class="keyword">this</span>.hooks.afterCompile.call()</span><br><span class="line">&gt;     <span class="keyword">this</span>.emitFile()</span><br><span class="line">&gt;     <span class="keyword">this</span>.hooks.emit.call()</span><br><span class="line">&gt;     <span class="keyword">this</span>.hooks.done.call()</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; <span class="built_in">module</span>.exports = Compiler</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="webpackconfigjs-3"><a class="markdownIt-Anchor" href="#webpackconfigjs-3"></a> webpack.config.js</h3>
<blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line">&gt; <span class="comment">//模拟插件</span></span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">P</span></span>&#123;</span><br><span class="line">&gt;   apply(compiler)&#123;</span><br><span class="line">&gt;     <span class="comment">//发射 订阅</span></span><br><span class="line">&gt;     compiler.hooks.emit.tap(<span class="string">'emit'</span>,()=&gt;&#123;</span><br><span class="line">&gt;       <span class="built_in">console</span>.log(<span class="string">'emit事件'</span>)</span><br><span class="line">&gt;     &#125;)</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">P1</span></span>&#123;</span><br><span class="line">&gt;   apply(compiler)&#123;</span><br><span class="line">&gt;     <span class="comment">//发射 订阅</span></span><br><span class="line">&gt;     compiler.hooks.afterPlugins.tap(<span class="string">'emit'</span>,()=&gt;&#123;</span><br><span class="line">&gt;       <span class="built_in">console</span>.log(<span class="string">'afterPlugins'</span>)</span><br><span class="line">&gt;     &#125;)</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">&gt;   mode: <span class="string">'development'</span>,</span><br><span class="line">&gt;   entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">&gt;   output:&#123;</span><br><span class="line">&gt;     filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">&gt;     path: path.resolve(__dirname,<span class="string">'dist'</span>)</span><br><span class="line">&gt;   &#125;,</span><br><span class="line">&gt;   <span class="built_in">module</span>:&#123;</span><br><span class="line">&gt;     rules:[</span><br><span class="line">&gt;       &#123;</span><br><span class="line">&gt;         test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">&gt;         use:[</span><br><span class="line">&gt;           path.resolve(__dirname,<span class="string">'loader'</span>,<span class="string">'style-loader'</span>),</span><br><span class="line">&gt;           path.resolve(__dirname,<span class="string">'loader'</span>,<span class="string">'less-loader'</span>)</span><br><span class="line">&gt;         ]</span><br><span class="line">&gt;       &#125;</span><br><span class="line">&gt;     ]</span><br><span class="line">&gt;   &#125;,</span><br><span class="line">&gt;   plugins:[</span><br><span class="line">&gt;     <span class="keyword">new</span> P(),</span><br><span class="line">&gt;     <span class="keyword">new</span> P1()</span><br><span class="line">&gt;   ]</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="less-loaderjs"><a class="markdownIt-Anchor" href="#less-loaderjs"></a> less-loader.js</h3>
<blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">let</span> less = <span class="built_in">require</span>(<span class="string">'less'</span>)</span><br><span class="line">&gt; <span class="keyword">let</span> css = <span class="string">''</span></span><br><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>)</span>&#123;</span><br><span class="line">&gt;   less.render(source,(error,c)=&gt;&#123;</span><br><span class="line">&gt;     css = c.css</span><br><span class="line">&gt;   &#125;)</span><br><span class="line">&gt;   <span class="comment">//正则 将/n替换成//n 不然会被当做转义字符来处理 不换行</span></span><br><span class="line">&gt;   css = css.replace(<span class="regexp">/\n/g</span>,<span class="string">'\\n'</span>)</span><br><span class="line">&gt;   <span class="keyword">return</span> css</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; <span class="built_in">module</span>.exports = loader</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="style-loaderjs"><a class="markdownIt-Anchor" href="#style-loaderjs"></a> style-loader.js</h3>
<blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">let</span> style = <span class="string">''</span></span><br><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>)</span>&#123;</span><br><span class="line">&gt;   style = <span class="string">`let style = document.createElement('style')</span></span><br><span class="line"><span class="string">&gt;   style.innerHTML = <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(source)&#125;</span></span></span><br><span class="line"><span class="string">&gt;   document.head.appendChild(style)`</span></span><br><span class="line">&gt;   <span class="keyword">return</span> style</span><br><span class="line">&gt; </span><br><span class="line">&gt;   <span class="comment">//style.innerHTML = JSON.stringify(loader) 可以将index.less的代码转为一行</span></span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="built_in">module</span>.exports = loader</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="mainejs"><a class="markdownIt-Anchor" href="#mainejs"></a> main.ejs</h3>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&gt; (function(modules) &#123; // webpackBootstrap   webpack入口函数</span><br><span class="line">&gt; 	var installedModules = &#123;&#125;;</span><br><span class="line">&gt; 	function __webpack_require__(moduleId) &#123;</span><br><span class="line">&gt; 		if(installedModules[moduleId]) &#123;</span><br><span class="line">&gt; 			return installedModules[moduleId].exports;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     var module = installedModules[moduleId] = &#123;</span><br><span class="line">&gt; 			i: moduleId,</span><br><span class="line">&gt; 			l: false,</span><br><span class="line">&gt; 			exports: &#123;&#125;</span><br><span class="line">&gt; 		&#125;;</span><br><span class="line">&gt; 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);</span><br><span class="line">&gt; 		return module.exports;</span><br><span class="line">&gt; 	&#125;</span><br><span class="line">&gt; return __webpack_require__(__webpack_require__.s = &quot;&lt;%-entryId%&gt;&quot;);//入口模块</span><br><span class="line">&gt; &#125;)</span><br><span class="line">&gt; </span><br><span class="line">&gt; (&#123;</span><br><span class="line">&gt;   &lt;%for(let key in modules) &#123;%&gt;</span><br><span class="line">&gt;     &quot;&lt;%-key%&gt;&quot;:   //key-&gt;模块的路径</span><br><span class="line">&gt;     (function(module, exports,__webpack_require__) &#123;  </span><br><span class="line">&gt;       eval(`&lt;%-modules[key]%&gt;`);</span><br><span class="line">&gt;     &#125;),</span><br><span class="line">&gt;   &lt;%&#125;%&gt;</span><br><span class="line">&gt; &#125;);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="loader-配置"><a class="markdownIt-Anchor" href="#loader-配置"></a> loader 配置</h2>
<p>webpack 只能处理 JavaScript 的模块，如果要处理其他类型的文件，需要使用 loader 进行转换。loader 是指用来将一段代码转换成另一端代码的 webpack 加载器。</p>
<h3 id="三种配置loader路径方式"><a class="markdownIt-Anchor" href="#三种配置loader路径方式"></a> 三种配置loader路径方式</h3>
<p>在项目根目录下创建loader 文件夹，增加 <code>loader1.js</code> ，loader 就是一个函数参数是匹配到文件的内容，返回的结果会作为最新的内容。可用以下三种方式配置自定义loader 的路径：</p>
<ol>
<li>
<p>直接在 <code>use</code> 中使用path.resolve</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">         test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">         use: path.resolve(__dirname, <span class="string">'loaders'</span>, <span class="string">'loader1.js'</span>) <span class="comment">// 使用loaders目录下的loader1.js</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置 loader别名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...,</span><br><span class="line">  resolveLoader: &#123;</span><br><span class="line">  	alias:&#123;</span><br><span class="line">      <span class="string">'loader1'</span>: path.resolve(__dirname,<span class="string">'loader'</span>,<span class="string">'loader1.js'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">	&#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">         test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">         use: <span class="string">'loader1'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置modules  默认去node_modules下找 找不到去loader文件夹下找</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...,</span><br><span class="line">  resolveLoader: &#123;</span><br><span class="line">  	modules:[<span class="string">'node_modules'</span>,path.resolve(__dirname,<span class="string">'loader'</span>)]</span><br><span class="line">	&#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">         test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">         use: <span class="string">'loader1'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="配置多个-loader"><a class="markdownIt-Anchor" href="#配置多个-loader"></a> 配置多个 loader</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...,</span><br><span class="line">  resolveLoader: &#123;</span><br><span class="line">  	modules:[<span class="string">'node_modules'</span>,path.resolve(__dirname,<span class="string">'loader'</span>)]</span><br><span class="line">	&#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">use</span>: <span class="string">'loader1'</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">use</span>: <span class="string">'loader2'</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">use</span>: <span class="string">'loader3'</span> &#125;</span><br><span class="line">      <span class="comment">// 或者直接用数组</span></span><br><span class="line">      <span class="comment">// &#123; test: /\.js$/, use: ['loader1', 'loader2','loader3'] &#125;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>默认</strong>执行顺序是 <strong>从下到上</strong>，<strong>从右到左</strong>，上面loader的执行顺序为：‘loader3’ —&gt; ‘loader2’ —&gt; ‘loader1’</p>
<h3 id="loader的分类"><a class="markdownIt-Anchor" href="#loader的分类"></a> loader的分类</h3>
<p>前置loader：pre</p>
<p>普通loader：normal</p>
<p>后置loader：post</p>
<p>loader的标准顺序：pre —&gt; normal —&gt; inline(行内) —&gt; post</p>
<h4 id="示例"><a class="markdownIt-Anchor" href="#示例"></a> <strong>示例</strong></h4>
<p>目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">test</span><br><span class="line">├── src</span><br><span class="line">│   ├──index.js</span><br><span class="line">│   └── a.js</span><br><span class="line">│ </span><br><span class="line">├── loader</span><br><span class="line">│   ├── inline-loader.js</span><br><span class="line">│   ├── loader1.js</span><br><span class="line">│   ├── loader2.js</span><br><span class="line">│   └── loader3.js</span><br><span class="line">│ </span><br><span class="line">├── webpack.config.js</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">"development"</span>,</span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">"build.js"</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  resolveLoader: &#123;</span><br><span class="line">    modules: [<span class="string">"node_modules"</span>, path.resolve(__dirname, <span class="string">"loader"</span>)]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: <span class="string">'loader1'</span>, <span class="comment">// 使用loaders目录下的loader1.js</span></span><br><span class="line">        enforce: <span class="string">'pre'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: <span class="string">'loader2'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: <span class="string">'loader3'</span>,</span><br><span class="line">        enforce: <span class="string">'post'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>inline-loader.js、loader1.js、loader2.js、loader3.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inline-loader.js、</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>)</span>&#123; <span class="comment">//loader的参数就是源代码</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'inline-loader~~~~~'</span>)</span><br><span class="line">  <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br><span class="line"></span><br><span class="line"><span class="comment">// loader1.js、</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>)</span>&#123; <span class="comment">//loader的参数就是源代码</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'loader1~~~~~'</span>)</span><br><span class="line">  <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br><span class="line"></span><br><span class="line"><span class="comment">// loader2.js、</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>)</span>&#123; <span class="comment">//loader的参数就是源代码</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'loader2~~~~~'</span>)</span><br><span class="line">  <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br><span class="line"></span><br><span class="line"><span class="comment">// loader3.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>)</span>&#123; <span class="comment">//loader的参数就是源代码</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'loader3~~~~~'</span>)</span><br><span class="line">  <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br></pre></td></tr></table></figure>
<p>index.js、a.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> str = <span class="built_in">require</span>(<span class="string">'./a.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="string">'it is a.js'</span></span><br></pre></td></tr></table></figure>
<p>在控制台执行 <code>npx webpack</code>，则控制台会出现以下打印</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">loader1~~~~~</span><br><span class="line">loader2~~~~~</span><br><span class="line">loader3~~~~~</span><br><span class="line">loader1~~~~~</span><br><span class="line">loader2~~~~~</span><br><span class="line">loader3~~~~~</span><br><span class="line"><span class="meta">#</span><span class="bash"> 因为有 2 个js文件，所以执行了2遍loader,并且设置了 pre、post，所以顺序是1、2、3</span></span><br></pre></td></tr></table></figure>
<h4 id="内联inline"><a class="markdownIt-Anchor" href="#内联inline"></a> 内联(inline)</h4>
<p>可以在 <code>import</code> 语句或任何 <a href="https://webpack.docschina.org/api/module-methods" target="_blank" rel="noopener">等同于 “import” 的方法</a> 中指定 loader。使用 <code>!</code> 将资源中的 loader 分开。每个部分都会相对于当前目录解析。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Styles <span class="keyword">from</span> <span class="string">'css-loader!./styles.css'</span>;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="built_in">require</span>(<span class="string">'inline-loader!./a.js'</span>)</span><br></pre></td></tr></table></figure>
<p>还是用上面的实例，改变 <code>index.js</code> 文件的内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="built_in">require</span>(<span class="string">'inline-loader!./a.js'</span>)</span><br></pre></td></tr></table></figure>
<p>再执行 <code>npx webpack</code>，则控制台会出现以下打印</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">loader1~~~~~</span><br><span class="line">loader2~~~~~</span><br><span class="line">loader3~~~~~</span><br><span class="line">loader1~~~~~</span><br><span class="line">loader2~~~~~</span><br><span class="line">inline-loader~~~~~</span><br><span class="line">loader3~~~~~</span><br></pre></td></tr></table></figure>
<p>因为在引入 <code>a.js</code> 时，前面添加了 <code>inline-loader!</code> 使用了内联（inline）loader，所以顺序是：pre —&gt; normal —&gt; inline(行内) —&gt; post</p>
<h5 id="符号的含义"><a class="markdownIt-Anchor" href="#符号的含义"></a> 符号的含义</h5>
<blockquote>
<p><code>-!</code> 禁用前置（pre）和正常（normal）loader<br>
<code>!</code> 禁用普通（normal）loader<br>
<code>!!</code> 禁用前置、后置和正常 loader</p>
<p>即：</p>
<p>所有普通 loader 可以通过在请求中加上 <code>!</code> 前缀来忽略（覆盖）。</p>
<p>所有普通和前置 loader 可以通过在请求中加上 <code>-!</code> 前缀来忽略（覆盖）。</p>
<p>所有普通，后置和前置 loader 可以通过在请求中加上 <code>!!</code> 前缀来忽略（覆盖）。</p>
<p>不应该使用行内 loader 和 <code>!</code> 前缀，因为它们是非标准的。它们可在由 loader 生成的代码中使用。</p>
</blockquote>
<p>改变 <code>index.js</code> 文件的内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="built_in">require</span>(<span class="string">'!inline-loader!./a.js'</span>)</span><br></pre></td></tr></table></figure>
<p>再执行 <code>npx webpack</code>，则控制台会出现以下打印</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">loader1~~~~~</span><br><span class="line">loader2~~~~~</span><br><span class="line">loader3~~~~~</span><br><span class="line">loader1~~~~~</span><br><span class="line">inline-loader~~~~~</span><br><span class="line">loader3~~~~~</span><br></pre></td></tr></table></figure>
<p>因为在 <code>inline-loader!</code> 的前面添加了 <code>!</code> ，则不使用 normal loader，而 loader2 是 normal loader，所以没有使用 loader2 。因此 loader 执行顺序是：pre —&gt; inline(行内) —&gt; post</p>
<p>改变 <code>index.js</code> 文件的内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="built_in">require</span>(<span class="string">'-!inline-loader!./a.js'</span>)</span><br></pre></td></tr></table></figure>
<p>再执行 <code>npx webpack</code>，则控制台会出现以下打印</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">loader1~~~~~</span><br><span class="line">loader2~~~~~</span><br><span class="line">loader3~~~~~</span><br><span class="line">inline-loader~~~~~</span><br><span class="line">loader3~~~~~</span><br></pre></td></tr></table></figure>
<p>因为在 <code>inline-loader!</code> 的前面添加了 <code>-!</code> ，则不使用 normal loader，而 loader1 是 pre loader， loader2 是 normal loader，所以没有使用 loader2 。因此 loader 执行顺序是：inline(行内) —&gt; post</p>
<p>改变 <code>index.js</code> 文件的内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="built_in">require</span>(<span class="string">'!!inline-loader!./a.js'</span>)</span><br></pre></td></tr></table></figure>
<p>再执行 <code>npx webpack</code>，则控制台会出现以下打印</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">loader1~~~~~</span><br><span class="line">loader2~~~~~</span><br><span class="line">loader3~~~~~</span><br><span class="line">inline-loader~~~~~</span><br></pre></td></tr></table></figure>
<p>因为在 <code>inline-loader!</code> 的前面添加了 <code>!!</code> ，则只用 inline loader，而 inline-loader是 inline loader，所以没有使用 loader1 、loader2 、 loader3 。因此 loader 执行顺序是：inline(行内)</p>
<h3 id="pitchloader-和-normalloader"><a class="markdownIt-Anchor" href="#pitchloader-和-normalloader"></a> pitchLoader 和 normalLoader</h3>
<p>每个 loader 都有两部分组成：pitchLoader 和 normalLoader，pitch 和 normal 的执行顺序正好相反，当 pitch 没有定义或者没有返回值时，会先执行 pitch 再获取资源执行 Loader，如果定义的某个 pitch 有返回值则会跳过读取资源和自己的 loader。</p>
<blockquote>
<p>所有一个接一个地进入的 loader，都有两个阶段：</p>
<ol>
<li><strong>pitching</strong> 阶段：loader 上的 pitch 方法，按照 <code>后置(post)、行内(normal)、普通(inline)、前置(pre)</code> 的顺序调用。更多详细信息，请查看 <a href="https://webpack.docschina.org/api/loaders/#pitching-loader" target="_blank" rel="noopener">越过 loader(pitching loader)</a>。</li>
<li><strong>normal</strong>阶段：loader 上的 常规方法，按照 <code>前置(pre)、行内(normal)、普通(inline)、后置(post)</code> 的顺序调用。模块源码的转换，发生在这个阶段。</li>
</ol>
<p>参考：<a href="https://webpack.docschina.org/configuration/module/#rule-enforce" target="_blank" rel="noopener">https://webpack.docschina.org/configuration/module/#rule-enforce</a></p>
</blockquote>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;user: [loader3, loader2, loader1]</span><br><span class="line">&gt;</span><br><span class="line">&gt;----------pitch loader 无返回值---------  </span><br><span class="line">&gt;pitch:   loader3 → loader2 → loader1  </span><br><span class="line">&gt;                                    ↘ </span><br><span class="line">&gt;                                      资源</span><br><span class="line">&gt;                                    ↙</span><br><span class="line">&gt;normal:  loader3 ← loader2 ← loader1 </span><br><span class="line">&gt;</span><br><span class="line">&gt;----------pitch 有返回值---------</span><br><span class="line">&gt;</span><br><span class="line">&gt;---------pitch loader 有返回值 --------</span><br><span class="line">&gt;pitch:   loader3 → loader2  loader1  </span><br><span class="line">&gt;                     ↙               </span><br><span class="line">&gt;               有返回值               资源</span><br><span class="line">&gt;               ↙                      </span><br><span class="line">&gt;normal:  loader3   loader2  loader1</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">//loader2.js</span></span><br><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>)</span>&#123; <span class="comment">//loader的参数就是源代码</span></span><br><span class="line">&gt;  <span class="built_in">console</span>.log(<span class="string">'loader2~~~~'</span>)</span><br><span class="line">&gt;  <span class="keyword">return</span> source;</span><br><span class="line">&gt;&#125;</span><br><span class="line">&gt;loader.pitch = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&gt;  <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line">&gt;&#125;</span><br><span class="line">&gt;<span class="built_in">module</span>.exports = loader</span><br><span class="line">&gt;</span><br><span class="line">&gt;<span class="comment">// 这样的运行结果：</span></span><br><span class="line">&gt;<span class="comment">// loader3~~~~~</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="自己实现-loader"><a class="markdownIt-Anchor" href="#自己实现-loader"></a> 自己实现 loader</h2>
<blockquote>
<p>示例项目：<a href="https://github.com/cheungww/loader_test" target="_blank" rel="noopener">https://github.com/cheungww/loader_test</a></p>
</blockquote>
<p>示例目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">test</span><br><span class="line">├── README.md</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── webpack.config.js</span><br><span class="line">├── src</span><br><span class="line">│   ├── a.js</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   ├── index.less</span><br><span class="line">│   └── shop.jpg</span><br><span class="line">└── loader</span><br><span class="line">    ├── babel-loader.js</span><br><span class="line">    ├── banner-loader.js</span><br><span class="line">    ├── file-loader.js</span><br><span class="line">    ├── url-loader.js</span><br><span class="line">    ├── babel-loader.js</span><br><span class="line">    ├── babel-loader.js</span><br><span class="line">    └── babel-loader.js</span><br></pre></td></tr></table></figure>
<h3 id="babel-loader"><a class="markdownIt-Anchor" href="#babel-loader"></a> babel-loader</h3>
<p>此 package 允许你使用 <a href="https://github.com/babel/babel" target="_blank" rel="noopener">Babel</a> 和 <a href="https://github.com/webpack/webpack" target="_blank" rel="noopener">webpack</a> 转译 <code>JavaScript</code> 文件。</p>
<blockquote>
<p><strong>Babel 是一个 JavaScript 编译器</strong></p>
<p>Babel 是一个工具链，主要用于在旧的浏览器或环境中将 ECMAScript 2015+ 代码转换为向后兼容版本的 JavaScript 代码：</p>
<ul>
<li>转换语法</li>
<li>Polyfill 实现目标环境中缺少的功能 (通过 <a href="https://babel.docschina.org/docs/en/babel-polyfill" target="_blank" rel="noopener">@babel/polyfill</a>)</li>
<li>源代码转换 (codemods)</li>
<li>更多！（查看<a href="https://babel.docschina.org/videos.html" target="_blank" rel="noopener">视频</a>）</li>
</ul>
</blockquote>
<p><strong>预先安装</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 webpack</span></span><br><span class="line">yarn add webpack webpack-cli -D</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装 @babel/core @babel/preset-env来测试 babel-loader</span></span><br><span class="line">yarn add @babel/core @babel/preset-env</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装 loader-utils 来</span></span><br><span class="line">yarn add loader-utils</span><br></pre></td></tr></table></figure>
<p>babel-loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> babel = <span class="built_in">require</span>(<span class="string">"@babel/core"</span>);</span><br><span class="line"><span class="comment">//loaderUtils 拿到预设  便于后期转化代码</span></span><br><span class="line"><span class="keyword">let</span> loaderUtils = <span class="built_in">require</span>(<span class="string">"loader-utils"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>&#123; <span class="comment">// this loaderContext</span></span><br><span class="line">  <span class="comment">//Object.keys方法  属性转成一个数组</span></span><br><span class="line">  <span class="keyword">let</span> options = loaderUtils.getOptions(<span class="keyword">this</span>);</span><br><span class="line">  <span class="comment">// console.log(this.resourcePath)  运行时返回一个绝对路径</span></span><br><span class="line">  <span class="comment">//console.log(options);</span></span><br><span class="line">  <span class="comment">// options 打印为&#123; presets: [ '@babel/preset-env' ] &#125;</span></span><br><span class="line">  <span class="keyword">let</span> cb = <span class="keyword">this</span>.async() <span class="comment">// loader上下文 默认有async这个方法 异步执行 在哪执行调用cb就可以</span></span><br><span class="line">  <span class="comment">//babel的transform有三个参数  第一个 转换哪些代码  第二个 转换选项  第三个 异步回调函数</span></span><br><span class="line">  babel.transform(source,&#123;</span><br><span class="line">    ...options, <span class="comment">//对象展开</span></span><br><span class="line">    sourceMap: <span class="literal">true</span>, <span class="comment">//调试工具 需要webpack.config.js 也要配置 source-map</span></span><br><span class="line">    filename:  <span class="keyword">this</span>.resourcePath.split(<span class="string">'/'</span>).pop()<span class="comment">//文件名  不然运行时 webpack下边是unkown</span></span><br><span class="line"></span><br><span class="line">  &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//异步回调  return source就不起作用了</span></span><br><span class="line">    cb(err,result.code,result.map)  <span class="comment">// 异步 cb(123) 会错误 必须严格按照参数来 </span></span><br><span class="line">    <span class="comment">// 第一个 错误  第二个  代码  第三个 sourceMap</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// return source; 不起作用</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  devtool: <span class="string">'source-map'</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="banner-loader"><a class="markdownIt-Anchor" href="#banner-loader"></a> banner-loader</h3>
<p>此 package 允许你给指定类型文件添加注释</p>
<p>预先安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">提前安装</span></span><br><span class="line">yarn add webpack webpack-cli -D</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装 loader-utils 来</span></span><br><span class="line">yarn add loader-utils</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装 schema-utils 骨架校验</span></span><br><span class="line">yarn add schema-utils</span><br></pre></td></tr></table></figure>
<p>banner-loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>)</span><br><span class="line"><span class="comment">//骨架校验</span></span><br><span class="line"><span class="keyword">let</span> validateOptions = <span class="built_in">require</span>(<span class="string">'schema-utils'</span>)</span><br><span class="line"><span class="comment">//读取文件模块</span></span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cacheable &amp;&amp; <span class="keyword">this</span>.cacheable() <span class="comment">//一般这样用 </span></span><br><span class="line">  <span class="comment">//this.cacheable(false) //缓存  自动缓存</span></span><br><span class="line">  <span class="keyword">let</span> options = loaderUtils.getOptions(<span class="keyword">this</span>)</span><br><span class="line">  <span class="keyword">let</span> cb = <span class="keyword">this</span>.async() <span class="comment">//异步必备</span></span><br><span class="line">  <span class="keyword">let</span> schema = &#123;</span><br><span class="line">    type: <span class="string">'object'</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      text: &#123;</span><br><span class="line">        type: <span class="string">'string'</span>,</span><br><span class="line"></span><br><span class="line">      &#125;,</span><br><span class="line">      filename: &#123;</span><br><span class="line">        type: <span class="string">'string'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将骨架和参数对比   'banner-loader'出问题（如果报错）</span></span><br><span class="line">  validateOptions(schema, options, <span class="string">'banner-loader'</span>)</span><br><span class="line">  <span class="keyword">if</span> (options.filename) &#123;</span><br><span class="line">    <span class="keyword">this</span>.addDependency(options.filename) <span class="comment">//自动地 添加文件依赖   加入这一句话 开启实时监控 webpack也会监控这个文件 这个文件更新也会实时更新</span></span><br><span class="line">    fs.readFile(options.filename, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">      cb(err, <span class="string">`/**<span class="subst">$&#123;data&#125;</span>**/<span class="subst">$&#123;source&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//同步也得 cb调用了</span></span><br><span class="line">    cb(<span class="literal">null</span>, <span class="string">`/**<span class="subst">$&#123;options.text&#125;</span>**/<span class="subst">$&#123;source&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// return source 又是异步  需要创建一个cb</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use:&#123;</span><br><span class="line">          loader: <span class="string">'banner-loader'</span>,</span><br><span class="line">          options:&#123;</span><br><span class="line">            text: <span class="string">'给js文件添加注释'</span>,</span><br><span class="line">            <span class="comment">//如果没有给text的时候,可以把注释内容写在指定的文件，例banner.js</span></span><br><span class="line">            <span class="comment">// filename: path.resolve(__dirname,'banner.js')</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>banner.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">banner-loader 默认的注释</span><br></pre></td></tr></table></figure>
<h3 id="file-loader"><a class="markdownIt-Anchor" href="#file-loader"></a> file-loader</h3>
<p><code>file-loader</code> 将文件上的 <code>import</code>/<code>require()</code> 解析为url，并将该文件发射到输出目录中。</p>
<p><strong>预先安装</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 webpack</span></span><br><span class="line">yarn add webpack webpack-cli -D</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 loader-utils 来获取webpack.config.js里loader的options</span></span><br><span class="line">yarn add loader-utils</span><br></pre></td></tr></table></figure>
<p>file-loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//根据当前格式 来生成图片路径 </span></span><br><span class="line">  <span class="keyword">let</span> filename = loaderUtils.interpolateName(<span class="keyword">this</span>, <span class="string">'[hash].[ext]'</span>, &#123; <span class="attr">content</span>: source &#125;) <span class="comment">//根据当前内容来产生hash值</span></span><br><span class="line">  <span class="keyword">this</span>.emitFile(filename, source)  <span class="comment">//内部方法 发射文件</span></span><br><span class="line">  <span class="comment">//处理 图片 需要返回一个模块</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`module.exports = "<span class="subst">$&#123;filename&#125;</span>"`</span></span><br><span class="line">&#125;</span><br><span class="line">loader.raw = <span class="literal">true</span>  <span class="comment">//返回二进制</span></span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.jpg$/</span>,</span><br><span class="line">        <span class="comment">// 目的 根据图片生成一个 md5串 发射到dist目录下 file-loader还会返回当前路径</span></span><br><span class="line">        use:&#123;</span><br><span class="line">          loader: <span class="string">'file-loader'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="url-loader"><a class="markdownIt-Anchor" href="#url-loader"></a> url-loader</h3>
<p>url-loader 可以将文件转换为base64 URI</p>
<p><strong>预先安装</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 webpack</span></span><br><span class="line">yarn add webpack webpack-cli -D</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 loader-utils 来获取webpack.config.js里loader的options</span></span><br><span class="line">yarn add loader-utils</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 mime 来解析文件后缀名</span></span><br><span class="line">yarn add mime</span><br></pre></td></tr></table></figure>
<p>url-loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>)</span><br><span class="line"><span class="comment">// 获取后缀名</span></span><br><span class="line"><span class="keyword">let</span> mime = <span class="built_in">require</span>(<span class="string">'mime'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; limit &#125; = loaderUtils.getOptions(<span class="keyword">this</span>)</span><br><span class="line">  <span class="keyword">if</span> (limit &amp;&amp; limit &gt; source.length) &#123;</span><br><span class="line">    <span class="comment">//转成base64编码</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`module.exports = "data:<span class="subst">$&#123;mime.getType(<span class="keyword">this</span>.resourcePath)&#125;</span>;base64,<span class="subst">$&#123;source.toString(<span class="string">'base64'</span>)&#125;</span>"`</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 返回file-loader  this和source通过call传入 防止参数变乱</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'./file-loader'</span>).call(<span class="keyword">this</span>, source)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">loader.raw = <span class="literal">true</span> <span class="comment">//转为二进制</span></span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.jpg$/</span>,</span><br><span class="line">        <span class="comment">//符号中文  会报Invalid or unexpected token</span></span><br><span class="line">        use:&#123;  </span><br><span class="line">          loader: <span class="string">'url-loader'</span>, <span class="comment">//url-loader会处理路径并且交给file-loader</span></span><br><span class="line">          options:&#123;</span><br><span class="line">            <span class="comment">// 如果图片小于200k，则转成 base64，</span></span><br><span class="line">            <span class="comment">// 即 &lt;img src="data:image/jpeg;base64,/9j/...&gt;</span></span><br><span class="line">            <span class="comment">// 如果图片大于200k，则交给file-loader来处理</span></span><br><span class="line">            limit: <span class="number">200</span>*<span class="number">1024</span> </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> p <span class="keyword">from</span> <span class="string">'./shop.jpg'</span></span><br><span class="line"><span class="built_in">console</span>.log(p)</span><br><span class="line"><span class="keyword">let</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>)</span><br><span class="line">img.src = p</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(img)</span><br></pre></td></tr></table></figure>
<h3 id="style-loader-css-loader-less-loader"><a class="markdownIt-Anchor" href="#style-loader-css-loader-less-loader"></a> style-loader、css-loader、less-loader</h3>
<p>style-loader 通过注入<code>&lt;style&gt;</code> 标签将CSS添加到 DOM 中</p>
<p>css-loader会像 <code>import / require（）</code> 一样解释 <code>@import</code> 和 <code>url（）</code> ，并将解析它们。</p>
<p>less-loader 是处理 less 的 webpack loader。将 Less 编译为 CSS。</p>
<p><strong>预先安装</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 webpack</span></span><br><span class="line">yarn add webpack webpack-cli -D</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 loader-utils 来获取webpack.config.js里loader的options</span></span><br><span class="line">yarn add loader-utils</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 mime 来解析文件后缀名</span></span><br><span class="line">yarn add mime</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装less</span></span><br><span class="line">yarn add less</span><br></pre></td></tr></table></figure>
<p>less-loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> less = <span class="built_in">require</span>(<span class="string">'less'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> css</span><br><span class="line">  less.render(source, (err, r) =&gt; &#123;</span><br><span class="line">    css = r.css</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> css</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br></pre></td></tr></table></figure>
<p>css-loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> reg = <span class="regexp">/url\((.+?)\)/g</span></span><br><span class="line">  <span class="comment">//第一次查找肯定是从零开始查找</span></span><br><span class="line">  <span class="keyword">let</span> pos = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> arr = [<span class="string">'let list = []'</span>]</span><br><span class="line">  <span class="keyword">while</span> (current = reg.exec(source)) &#123;</span><br><span class="line">    <span class="keyword">let</span> [matchUrl, g] = current</span><br><span class="line">    <span class="comment">//reg.lastIndex 对应着匹配最后一个字符的长度 matchUrl对应着url('./lala.jpg')的长度</span></span><br><span class="line">    <span class="comment">//相减可以得到前边的不包含 url的值</span></span><br><span class="line">    <span class="keyword">let</span> last = reg.lastIndex - matchUrl.length</span><br><span class="line">    arr.push(<span class="string">`list.push(<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(source.slice(pos, last))&#125;</span>)`</span>)</span><br><span class="line">    <span class="comment">//把 g 替换成ruquire的写法</span></span><br><span class="line">    arr.push(<span class="string">`list.push('url('+ require(<span class="subst">$&#123;g&#125;</span>) +')')`</span>)</span><br><span class="line">    pos = reg.lastIndex</span><br><span class="line">    <span class="comment">// 添加后边的</span></span><br><span class="line">    arr.push(<span class="string">`list.push(<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(source.slice(pos))&#125;</span>)`</span>)</span><br><span class="line">    arr.push(<span class="string">`module.exports = list.join(' ')`</span>)</span><br><span class="line">    <span class="keyword">return</span> arr.join(<span class="string">'\r\n'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> source</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br></pre></td></tr></table></figure>
<p>style-loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>)</span><br><span class="line"><span class="keyword">let</span> style = <span class="string">''</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(source)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`style = document.createElement('style')</span></span><br><span class="line"><span class="string">  style.innerHTML = <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(source)&#125;</span></span></span><br><span class="line"><span class="string">  document.head.appendChild(style)`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在 style-laoder pitch上写一个返回值  就不执行后边  没有pitch source是一个css解析完成的字符串</span></span><br><span class="line">loader.pitch = <span class="function"><span class="keyword">function</span> (<span class="params">remainingRequest</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//loaderUtils.stringifyRequest(this,'!!'+remainingRequest) 会把绝对路径转化为相对路径 </span></span><br><span class="line">  <span class="comment">// 这样做是为了 相当于引入一个inline-loader来处理css-loader返回的值  不需要再走其他的loader 需要加'!!'</span></span><br><span class="line">  <span class="comment">// 参照 pitch用法以及inline-loader使用方式来理解</span></span><br><span class="line">  <span class="comment">// 就是 把 css转化的 list数组 转化为 style-loader能看懂的 字符串 </span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`style = document.createElement('style')</span></span><br><span class="line"><span class="string">  style.innerHTML = require(<span class="subst">$&#123;loaderUtils.stringifyRequest(<span class="keyword">this</span>, <span class="string">'!!'</span> + remainingRequest)&#125;</span>)</span></span><br><span class="line"><span class="string">  document.head.appendChild(style)`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = loader</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use:[</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          <span class="string">'css-loader'</span>,</span><br><span class="line">          <span class="string">'less-loader'</span>  </span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.jpg$/</span>,</span><br><span class="line">        <span class="comment">//符号中文  会报Invalid or unexpected token</span></span><br><span class="line">        use:&#123;  </span><br><span class="line">          loader: <span class="string">'url-loader'</span>, <span class="comment">//url-loader会处理路径并且交给file-loader</span></span><br><span class="line">          options:&#123;</span><br><span class="line">            <span class="comment">// 如果图片小于200k，则转成 base64，</span></span><br><span class="line">            <span class="comment">// 即 &lt;img src="data:image/jpeg;base64,/9j/...&gt;</span></span><br><span class="line">            <span class="comment">// 如果图片大于200k，则交给file-loader来处理</span></span><br><span class="line">            limit: <span class="number">200</span>*<span class="number">1024</span> </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./index.less'</span>;</span><br></pre></td></tr></table></figure>
<p>index.less</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@color:</span> red;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="variable">@color</span>;</span><br><span class="line">  <span class="attribute">background</span>: url(<span class="string">'./shop.jpg'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自己实现-plugin"><a class="markdownIt-Anchor" href="#自己实现-plugin"></a> 自己实现 plugin</h2>
<h3 id="webpack如何调用plugin"><a class="markdownIt-Anchor" href="#webpack如何调用plugin"></a> webpack如何调用plugin</h3>
<p>node_modules下的webpack下的lib中的Compiler.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> <span class="keyword">extends</span> <span class="title">Tapable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(context) &#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.hooks = &#123;</span><br><span class="line">			<span class="comment">/** @type &#123;SyncBailHook&lt;Compilation&gt;&#125; */</span></span><br><span class="line">			shouldEmit: <span class="keyword">new</span> SyncBailHook([<span class="string">"compilation"</span>]),</span><br><span class="line">			<span class="comment">/** @type &#123;AsyncSeriesHook&lt;Stats&gt;&#125; */</span></span><br><span class="line">			done: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">"stats"</span>]),</span><br><span class="line">			<span class="comment">/** @type &#123;AsyncSeriesHook&lt;&gt;&#125; */</span></span><br><span class="line">			additionalPass: <span class="keyword">new</span> AsyncSeriesHook([]),</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> childCompiler = <span class="keyword">new</span> Compiler(<span class="keyword">this</span>.context);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(plugins)) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> plugin <span class="keyword">of</span> plugins) &#123;</span><br><span class="line">    plugin.apply(childCompiler);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>定义一个插件类，然后再该插件类定义一个 <code>apply</code> 属性，因为在 <code>Compiler.js</code> 中给 <code>apply</code> 传入了 <code>childCompiler</code>，所以自定义的插件类的 <code>apply</code> 属性就可以利用 <code>childCompiler</code> 的 <code>this.hooks</code> 了</p>
<blockquote>
<p>示例项目：<a href="https://github.com/cheungww/plugin_test" target="_blank" rel="noopener">https://github.com/cheungww/plugin_test</a></p>
</blockquote>
<p>目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">test</span><br><span class="line">├── README.md</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── webpack.config.js</span><br><span class="line">├── src</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   ├── index.css</span><br><span class="line">│   └── index.html</span><br><span class="line">└── plugins</span><br><span class="line">    ├── DonePlugin.js</span><br><span class="line">    ├── AsyncPluginr.js</span><br><span class="line">    ├── FileListPlugin.js</span><br><span class="line">    ├── InlineSourcePlugin.js</span><br><span class="line">    └── UploadPlugin.js</span><br></pre></td></tr></table></figure>
<h3 id="doneplugin-asyncplugin"><a class="markdownIt-Anchor" href="#doneplugin-asyncplugin"></a> DonePlugin、AsyncPlugin</h3>
<p>插件 DonePlugin 的作用是当 webpack 编译完成后，在控制台打印提示语</p>
<p>插件 AsyncPlugin 的作用是当 webpack 发射文件时做一些异步操作</p>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack webpack-cli -D</span><br></pre></td></tr></table></figure>
<p>DonePlugin.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DonePlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) <span class="comment">// compiler.hooks</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//这样是一个同步代码</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">//第一个参数无所谓，放啥都可以  tapable的时候也是</span></span><br><span class="line">    compiler.hooks.done.tap(<span class="string">'DonePlugin'</span>, (states) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'编译完成哦哦哦'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//还需要导出一下</span></span><br><span class="line"><span class="built_in">module</span>.exports = DonePlugin</span><br></pre></td></tr></table></figure>
<p>AsyncPlugin.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncPlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    <span class="comment">//这样是一个同步代码</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">    compiler.hooks.emit.tapAsync(<span class="string">'AsyncPlugin'</span>, (compliation, cb) =&gt; &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'等一下'</span>)</span><br><span class="line">        cb()</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    compiler.hooks.emit.tapPromise(<span class="string">'AsyncPlugin'</span>, (compliation) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'再等一下'</span>)</span><br><span class="line">          resolve()</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = AsyncPlugin</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">let</span> DonePlugin = <span class="built_in">require</span>(<span class="string">'./plugins/DonePlugin.js'</span>)</span><br><span class="line"><span class="keyword">let</span> AsyncPlugin = <span class="built_in">require</span>(<span class="string">'./plugins/AsyncPlugin.js'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> DonePlugin(),</span><br><span class="line">    <span class="keyword">new</span> AsyncPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行 <code>npx webpack</code> 后，控制台会显示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">等一下</span><br><span class="line">再等一下</span><br><span class="line">编译完成哦哦哦</span><br></pre></td></tr></table></figure>
<h3 id="filelistplugin"><a class="markdownIt-Anchor" href="#filelistplugin"></a> FileListPlugin</h3>
<p>该插件的作用是输出一个文件，文件的内容是 打包后的所有的文件名及其大小</p>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack webpack-cli -D</span><br><span class="line">yarn add html-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<p>FileListPlugin.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileListPlugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(&#123; filename &#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.filename = filename;</span><br><span class="line">  &#125;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    <span class="comment">//文件准备好了，要进行发射</span></span><br><span class="line">    compiler.hooks.emit.tapAsync(<span class="string">"FileListPlugin"</span>, (compilation, cb) =&gt; &#123;</span><br><span class="line">      <span class="comment">// compilcation有很多的属性</span></span><br><span class="line">      <span class="comment">// 打包的资源都会放在compilcation的assets属性上</span></span><br><span class="line">      <span class="comment">// console.log(compilation.assets)</span></span><br><span class="line">      <span class="keyword">let</span> content = <span class="string">`##  文件名    资源大小\r\n`</span>;</span><br><span class="line">      <span class="keyword">let</span> assets = compilation.assets;</span><br><span class="line">      <span class="comment">//Object.entries() 可以把对象变成一个数组</span></span><br><span class="line">      <span class="built_in">Object</span>.entries(assets).forEach(<span class="function">(<span class="params">[filename, staObj]</span>) =&gt;</span> &#123;</span><br><span class="line">        content += <span class="string">`-  <span class="subst">$&#123;filename&#125;</span>    <span class="subst">$&#123;staObj.size()&#125;</span>\r\n`</span>;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      assets[<span class="keyword">this</span>.filename] = &#123;</span><br><span class="line">        source() &#123;</span><br><span class="line">          <span class="keyword">return</span> content;</span><br><span class="line">        &#125;,</span><br><span class="line">        size() &#123;</span><br><span class="line">          <span class="keyword">return</span> content.length;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      cb()</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = FileListPlugin;</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">let</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">let</span> FileListPlugin = <span class="built_in">require</span>(<span class="string">'./plugins/FileListPlugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">/* new DonePlugin(),</span></span><br><span class="line"><span class="comment">    new AsyncPlugin() */</span></span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./src/index.html'</span></span><br><span class="line">    &#125;),</span><br><span class="line">     <span class="keyword">new</span> FileListPlugin(&#123;</span><br><span class="line">       filename: <span class="string">'list.md'</span></span><br><span class="line">     &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行 <code>npx webpack</code> 后，在 dist 目录下会多出一个 <a href="http://list.md" target="_blank" rel="noopener">list.md</a> 文件，内容：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">##  文件名    资源大小</span></span><br><span class="line"><span class="bullet">-  </span>bundle.js    3860</span><br><span class="line"><span class="bullet">-  </span>index.html    56</span><br></pre></td></tr></table></figure>
<h3 id="inlinesourceplugin"><a class="markdownIt-Anchor" href="#inlinesourceplugin"></a> InlineSourcePlugin</h3>
<p>该插件是把外链标签变成内联</p>
<p>例如</p>
<p>打包后的 index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"main.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过 InlineSourcePlugin 插件将 index.html 中的 <code>link</code> 和 <code>script</code> 的外链的样式和脚本导入到 index.html 中去</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">  <span class="comment">/*-----main.css中的内容----------*/</span></span></span><br><span class="line"><span class="undefined">  body&#123; </span></span><br><span class="line"><span class="undefined">  	background-color: red;</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"application/javascript"</span>&gt;</span><span class="actionscript"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span><span class="params">(modules)</span> </span>&#123; <span class="comment">// webpackBootstrap</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">/*------------bundle.js中的内容------------------*/</span> </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yarn add css-loader mini-css-extract-plugin -D</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装最新版 html-webpack-plugin@next</span></span><br><span class="line">yarn add html-webpack-plugin@next -D</span><br></pre></td></tr></table></figure>
<p>InlineSourcePlugin.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="comment">//把外链标签变成内联</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InlineSourcePlugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(&#123; test &#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.reg = test <span class="comment">//正则</span></span><br><span class="line">  &#125;</span><br><span class="line">  processTag(tag, compilation) &#123;</span><br><span class="line">    <span class="keyword">let</span> newTag, url</span><br><span class="line">    <span class="keyword">if</span> (tag.tagName === <span class="string">'link'</span> &amp;&amp; <span class="keyword">this</span>.reg.test(tag.attributes.href)) &#123;</span><br><span class="line">      newTag = &#123;</span><br><span class="line">        tagName: <span class="string">'style'</span>,</span><br><span class="line">        attributes: &#123;</span><br><span class="line">          type: <span class="string">'text/css'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      url = tag.attributes.href</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag.tagName === <span class="string">'script'</span> &amp;&amp; <span class="keyword">this</span>.reg.test(tag.attributes.src)) &#123;</span><br><span class="line">      newTag = &#123;</span><br><span class="line">        tagName: <span class="string">'script'</span>,</span><br><span class="line">        attributes: &#123;</span><br><span class="line">          type: <span class="string">'application/javascript'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      url = tag.attributes.src</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (url) &#123;</span><br><span class="line">      newTag.innerHTML = compilation.assets[url].source() <span class="comment">//文件内容</span></span><br><span class="line">      <span class="comment">//删除这一个资源</span></span><br><span class="line">      <span class="keyword">delete</span> compilation.assets[url]</span><br><span class="line">      <span class="keyword">return</span> newTag</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tag</span><br><span class="line">  &#125;</span><br><span class="line">  processTags(data, compilation) &#123;</span><br><span class="line">    <span class="keyword">let</span> bodyTags = []</span><br><span class="line">    <span class="keyword">let</span> headTags = []</span><br><span class="line">    data.headTags.forEach(<span class="function"><span class="params">headTag</span> =&gt;</span> &#123;</span><br><span class="line">      headTags.push(<span class="keyword">this</span>.processTag(headTag, compilation))</span><br><span class="line">    &#125;)</span><br><span class="line">    data.bodyTags.forEach(<span class="function"><span class="params">bodyTag</span> =&gt;</span> &#123;</span><br><span class="line">      bodyTags.push(<span class="keyword">this</span>.processTag(bodyTag, compilation))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123; ...data, headTags, bodyTags &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    <span class="comment">//要通过 HtmlWebpackPlugin的钩子来实现这一功能 根据官网文档修改</span></span><br><span class="line">    compiler.hooks.compilation.tap(<span class="string">'InlineSourcePlugin'</span>, (compilation) =&gt; &#123;</span><br><span class="line">      HtmlWebpackPlugin.getHooks(compilation).alterAssetTagGroups.tapAsync(</span><br><span class="line">        <span class="string">'AfterPlugin'</span>,</span><br><span class="line">        (data, cb) =&gt; &#123;</span><br><span class="line">          <span class="comment">//将link变成内联  script变成内联</span></span><br><span class="line">          data = <span class="keyword">this</span>.processTags(data, compilation) <span class="comment">//compilation.assets 资源</span></span><br><span class="line">          cb(<span class="literal">null</span>, data)</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = InlineSourcePlugin</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">let</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">let</span> FileListPlugin = <span class="built_in">require</span>(<span class="string">'./plugins/FileListPlugin'</span>)</span><br><span class="line"><span class="keyword">let</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>)</span><br><span class="line"><span class="keyword">let</span> InlineSourcePlugin = <span class="built_in">require</span>(<span class="string">'./plugins/InlineSourcePlugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [MiniCssExtractPlugin.loader, <span class="string">'css-loader'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./src/index.html'</span></span><br><span class="line">    &#125;),</span><br><span class="line">     <span class="keyword">new</span> FileListPlugin(&#123;</span><br><span class="line">       filename: <span class="string">'list.md'</span></span><br><span class="line">     &#125;),</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'main.css'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> InlineSourcePlugin(&#123;</span><br><span class="line">      test: <span class="regexp">/(\.js|css)/</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="uploadplugin"><a class="markdownIt-Anchor" href="#uploadplugin"></a> UploadPlugin</h3>
<p>该插件的作用是打包后自动上传打包后的的文件到七牛</p>
<blockquote>
<p>需要这几个参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; bucket: &apos;&apos;  // 七牛的存储空间</span><br><span class="line">&gt; domain: &apos;&apos;,</span><br><span class="line">&gt; accessKey: &apos;&apos;, // 七牛云的两对密匙</span><br><span class="line">&gt; secretKey: &apos;&apos; // 七牛云的两对密匙</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>注册七牛，并在对象存储里面,新建存储空间列表<code>test</code>,<code>bucket: 'test'</code></p>
<p>内容管理外链接默认域名 <code>domain: 'xxxxxxxx'</code></p>
<p>右上角个人面板里面个人中心,密钥管理分别对应<code>accessKey</code>和<code>secretKey</code></p>
<p><a href="https://developer.qiniu.com/" target="_blank" rel="noopener">进入开发者中心</a> -&gt; SDK&amp;工具 -&gt; 官方SDK -&gt; Node服务端文档 —&gt; 文件上传</p>
<p><a href="https://developer.qiniu.com/kodo/sdk/1289/nodejs" target="_blank" rel="noopener">node文件上传</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; npm install qiniu</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><a href="https://webpack.docschina.org/api/compiler-hooks" target="_blank" rel="noopener">compiler-hooks</a></p>
</blockquote>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack webpack-cli -D</span><br><span class="line">yarn add html-webpack-plugin -D</span><br><span class="line">yarn add qiniu -D</span><br></pre></td></tr></table></figure>
<p>UploadPlugin.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> qiniu = <span class="built_in">require</span>(<span class="string">'qiniu'</span>)</span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UploadPlugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options = &#123;&#125;) &#123;</span><br><span class="line">    <span class="comment">// 参考 https://developer.qiniu.com/kodo/sdk/1289/nodejs</span></span><br><span class="line">    <span class="keyword">let</span> &#123; bucket = <span class="string">''</span>, domain = <span class="string">''</span>, accessKey = <span class="string">''</span>, secretKey = <span class="string">''</span> &#125; = options</span><br><span class="line">    <span class="keyword">let</span> mac = <span class="keyword">new</span> qiniu.auth.digest.Mac(accessKey, secretKey)</span><br><span class="line">    <span class="keyword">let</span> putPolicy = <span class="keyword">new</span> qiniu.rs.PutPolicy(&#123;</span><br><span class="line">      scope: bucket</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.uploadToken = putPolicy.uploadToken(mac)</span><br><span class="line">    <span class="keyword">let</span> config = <span class="keyword">new</span> qiniu.conf.Config();</span><br><span class="line">    <span class="keyword">this</span>.formUploader = <span class="keyword">new</span> qiniu.form_up.FormUploader(config)</span><br><span class="line">    <span class="keyword">this</span>.putExtra = <span class="keyword">new</span> qiniu.form_up.PutExtra()</span><br><span class="line">  &#125;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    compiler.hooks.afterEmit.tapPromise(<span class="string">'UploadPlugin'</span>, (complication) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> assets = complication.assets</span><br><span class="line">      <span class="keyword">let</span> promise = []</span><br><span class="line">      <span class="built_in">Object</span>.keys(assets).forEach(<span class="function"><span class="params">filename</span> =&gt;</span> &#123;</span><br><span class="line">        promise.push(<span class="keyword">this</span>.upload(filename))</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.all(promise)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  upload(filename) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> localFile = path.resolve(__dirname, <span class="string">'../dist'</span>, filename)</span><br><span class="line">      <span class="keyword">this</span>.formUploader.putFile(<span class="keyword">this</span>.uploadToken, filename, localFile, <span class="keyword">this</span>.putExtra, <span class="function"><span class="keyword">function</span> (<span class="params">respErr,</span></span></span><br><span class="line"><span class="function"><span class="params">        respBody, respInfo</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (respErr) &#123;</span><br><span class="line">          reject(respErr)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (respInfo.statusCode == <span class="number">200</span>) &#123;</span><br><span class="line">          resolve(respBody)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(respInfo.statusCode)</span><br><span class="line">          <span class="built_in">console</span>.log(respBody)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = UploadPlugin</span><br></pre></td></tr></table></figure>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">let</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">let</span> FileListPlugin = <span class="built_in">require</span>(<span class="string">'./plugins/FileListPlugin'</span>)</span><br><span class="line"><span class="keyword">let</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>)</span><br><span class="line"><span class="keyword">let</span> InlineSourcePlugin = <span class="built_in">require</span>(<span class="string">'./plugins/InlineSourcePlugin'</span>)</span><br><span class="line"><span class="keyword">let</span> UploadPlugin = <span class="built_in">require</span>(<span class="string">'./plugins/UploadPlugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'打包后上传文件的网址'</span> </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [MiniCssExtractPlugin.loader, <span class="string">'css-loader'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">/* new DonePlugin(),</span></span><br><span class="line"><span class="comment">    new AsyncPlugin() */</span></span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./src/index.html'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'main.css'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> InlineSourcePlugin(&#123;</span><br><span class="line">      test: <span class="regexp">/(\.js|css)/</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> UploadPlugin(&#123;</span><br><span class="line">      bucket: <span class="string">'test'</span>,  <span class="comment">// 七牛的存储空间</span></span><br><span class="line">      domain: <span class="string">'poyrjyh1b.bkt.clouddn.com'</span>,</span><br><span class="line">      accessKey: <span class="string">'xxxxxx'</span>, <span class="comment">// 七牛云的两对密匙</span></span><br><span class="line">      secretKey: <span class="string">'yyyyyy'</span> <span class="comment">// 七牛云的两对密匙</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2>
<blockquote>
<p><a href="https://github.com/1better/mywebpack" target="_blank" rel="noopener">mywebpack</a></p>
</blockquote>

      
    </div>

    <div>
      
      <div>

<div style="text-align:center;color: #ccc;font-size:14px;">-------文章到此结束&nbsp;<i class="fa fa-paw"></i>&nbsp;感谢您的阅读-------</div>

</div>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/webpack/" rel="tag"><i class="fa fa-tag"></i> webpack</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/834a9829.html" rel="next" title="小程序">
                <i class="fa fa-chevron-left"></i> 小程序
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/fa0406e7.html" rel="prev" title="npx使用教程">
                npx使用教程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="00前的小老弟">
            
              <p class="site-author-name" itemprop="name">00前的小老弟</p>
              <div class="site-description motion-element" itemprop="description">让兴趣变得更专业,让专业变得更兴趣</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">42</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">23</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/cheungww" title="GitHub &rarr; https://github.com/cheungww" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:1329105041@qq.com" title="E-Mail &rarr; mailto:1329105041@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#概念"><span class="nav-text"> 概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-text"> 安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基础配置-webpackconfigjs"><span class="nav-text"> 基础配置 webpack.config.js</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#html-插件"><span class="nav-text"> html 插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#样式处理"><span class="nav-text"> 样式处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转换-es6-语法"><span class="nav-text"> 转换 ES6 语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#js-语法校验"><span class="nav-text"> js 语法校验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全局变量的引入"><span class="nav-text"> 全局变量的引入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-text"> </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图片处理"><span class="nav-text"> 图片处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他"><span class="nav-text"> 其他</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置"><span class="nav-text"> 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用的小插件"><span class="nav-text"> 常用的小插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#打包多页应用"><span class="nav-text"> 打包多页应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dev-tool的四个选项"><span class="nav-text"> dev-tool的四个选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack跨域问题"><span class="nav-text"> webpack跨域问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#watch监视"><span class="nav-text"> watch监视</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resolve属性"><span class="nav-text"> resolve属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生产或者开发环境配置"><span class="nav-text"> 生产或者开发环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpackconfigjs"><span class="nav-text"> webpack.config.js</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化配置"><span class="nav-text"> 优化配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-2"><span class="nav-text"> 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack优化项"><span class="nav-text"> webpack优化项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽取公共代码"><span class="nav-text"> 抽取公共代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack懒加载"><span class="nav-text"> webpack懒加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack热更新"><span class="nav-text"> webpack热更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpackconfigjs-2"><span class="nav-text"> webpack.config.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpackreactjs输出manifestjson"><span class="nav-text"> webpack.react.js(输出manifest.json)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tapable"><span class="nav-text"> Tapable</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#同步钩子"><span class="nav-text"> 同步钩子</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#synchook"><span class="nav-text"> SyncHook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#syncbailhook"><span class="nav-text"> SyncBailHook</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#-2"><span class="nav-text"> </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#syncwaterfallhook"><span class="nav-text"> SyncWaterfallHook</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#-3"><span class="nav-text"> </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#syncloophook"><span class="nav-text"> SyncLoopHook</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#-4"><span class="nav-text"> </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步钩子"><span class="nav-text"> 异步钩子</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#asyncparrallehook"><span class="nav-text"> AsyncParralleHook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#asyncparrallehookpromise"><span class="nav-text"> AsyncParralleHook（promise）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#asyncparallelbailhookpromise的示例"><span class="nav-text"> AsyncParallelBailHook（promise）的示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#asyncserieshook"><span class="nav-text"> AsyncSeriesHook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#asyncserieshookpromise"><span class="nav-text"> AsyncSeriesHook（promise）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#asyncserieswaterfallhook"><span class="nav-text"> AsyncSeriesWaterfallHook</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#手写-webpack"><span class="nav-text"> 手写 webpack</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#项目目录"><span class="nav-text"> 项目目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-3"><span class="nav-text"> 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#packagejson"><span class="nav-text"> package.json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#npm-link的流程"><span class="nav-text"> npm link的流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hanke-webpackjs最开始配置"><span class="nav-text"> hanke-webpack.js最开始配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#compilejs"><span class="nav-text"> compile.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpackconfigjs-3"><span class="nav-text"> webpack.config.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#less-loaderjs"><span class="nav-text"> less-loader.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#style-loaderjs"><span class="nav-text"> style-loader.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mainejs"><span class="nav-text"> main.ejs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#loader-配置"><span class="nav-text"> loader 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#三种配置loader路径方式"><span class="nav-text"> 三种配置loader路径方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置多个-loader"><span class="nav-text"> 配置多个 loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loader的分类"><span class="nav-text"> loader的分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#示例"><span class="nav-text"> 示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内联inline"><span class="nav-text"> 内联(inline)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#符号的含义"><span class="nav-text"> 符号的含义</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pitchloader-和-normalloader"><span class="nav-text"> pitchLoader 和 normalLoader</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自己实现-loader"><span class="nav-text"> 自己实现 loader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#babel-loader"><span class="nav-text"> babel-loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#banner-loader"><span class="nav-text"> banner-loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#file-loader"><span class="nav-text"> file-loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#url-loader"><span class="nav-text"> url-loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#style-loader-css-loader-less-loader"><span class="nav-text"> style-loader、css-loader、less-loader</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自己实现-plugin"><span class="nav-text"> 自己实现 plugin</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack如何调用plugin"><span class="nav-text"> webpack如何调用plugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#doneplugin-asyncplugin"><span class="nav-text"> DonePlugin、AsyncPlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#filelistplugin"><span class="nav-text"> FileListPlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inlinesourceplugin"><span class="nav-text"> InlineSourcePlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uploadplugin"><span class="nav-text"> UploadPlugin</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-text"> 参考</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">00前的小老弟</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">603k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">9:08</span>
  
</div>









  <a href="http://www.beian.miit.gov.cn" rel="noopener" target="_blank">粤ICP备19129449号</a>

  | <span style="padding-left:25px;background:url(/images/ghs.png) no-repeat left center" rel="nofollow">
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44030502004585" rel="noopener" target="_blank">粤公网安备44030502004585号</a></span>
        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/affix.js?v=7.1.1"></script>

  <script src="/js/schemes/pisces.js?v=7.1.1"></script>




  
  <script src="/js/scrollspy.js?v=7.1.1"></script>
<script src="/js/post-details.js?v=7.1.1"></script>
<script type="text/javascript" src="/custom/fold_action.js?v=7.1.1"></script>



  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  

  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'jvJ2dAabT0aVqK1hUiF09lDk-gzGzoHsz',
    appKey: 'VGy8poI17GFNJlbk1pbieJ29',
    placeholder: '来这里到此一游吧！',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true,
    lang: '' || 'zh-cn'
  });
</script>




  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('3');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  
<script>
  $('.highlight').not('.gist .highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
